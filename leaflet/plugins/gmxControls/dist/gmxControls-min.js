L.Map.addInitHook(function(){var t=this._controlCorners,o=this._controlContainer,i="leaflet-top leaflet-bottom",e="leaflet-left leaflet-right",n={bottom:"leaflet-bottom "+e,gmxbottomleft:"leaflet-bottom leaflet-left",gmxbottomcenter:"leaflet-bottom "+e,gmxbottomright:"leaflet-bottom leaflet-right",center:i+" "+e,right:"leaflet-right "+i,left:"leaflet-left "+i,top:"leaflet-top "+e};for(var s in n)t[s]||(t[s]=L.DomUtil.create("div",n[s],o))}),L.Map.addInitHook(function(){var t=this,o=null,i="leaflet-control-gmx-hidden",e=["img/svg-symbols.svg"],n=["gmxLoaderStatus","gmxHide","gmxZoom","gmxDrawing","gmxBottom","gmxLocation","gmxCopyright","gmxCenter","gmxLogo"];this.gmxControlsManager={_controls:{},_svgLoaded:{},add:function(t){var e=t.options,n=e.id;return this._controls[n]=t,t instanceof L.Control.GmxHide&&(o=t),!o||o.options.isActive||e.notHide||t._parent||!t._container||L.DomUtil.addClass(t._container,i),this},remove:function(t){return delete this._controls[t.options.id],this},get:function(t){return this._controls[t]},getAll:function(){return this._controls},init:function(o){return o=o||{},t.options.svgSprite!==!1&&this.setSvgSprites(t.options.svgSprite),t.zoomControl&&!o.zoomControl&&t.removeControl(t.zoomControl),t.attributionControl&&!o.attributionControl&&t.removeControl(t.attributionControl),n.forEach(function(i){i in o&&null===o[i]||t.addControl(L.control[i](o[i]))}),this},setSvgSprites:function(o){o=o&&o!==!0?L.Util.isArray(o)?o:[o]:e;var i=this;return o.forEach(function(o){i._svgLoaded[o]||(i._svgLoaded[o]=!0,fetch(o,{mode:"cors"}).then(function(t){return t.text()}).then(function(i){var e=document.createElement("div");e.style.display="none",e.innerHTML=i,document.body.insertBefore(e,document.body.childNodes[0]),t.fire("svgspriteloaded",{url:o})}))}),t.options.svgSprite=o,this}},this.gmxControlIconManager=this.gmxControlsManager}),L.Control.GmxIcon=L.Control.extend({includes:L.Evented?L.Evented.prototype:L.Mixin.Events,options:{position:"topleft",id:"defaultIcon",isActive:!1},setActive:function(t,o){var i=this.options,e=i.togglable||i.toggle;if(e){var n=i.isActive,s=this._prefix,r=s+"-"+i.id,a=this._container;i.isActive=t,this._img&&(t&&i.activeImageUrl?this._img.src=i.activeImageUrl:!t&&i.regularImageUrl&&(this._img.src=i.regularImageUrl)),t?(L.DomUtil.addClass(a,s+"-active"),L.DomUtil.addClass(a,r+"-active"),a.children.length&&L.DomUtil.addClass(a,s+"-externalImage-active"),i.styleActive&&this.setStyle(i.styleActive)):(L.DomUtil.removeClass(a,s+"-active"),L.DomUtil.removeClass(a,r+"-active"),a.children.length&&L.DomUtil.removeClass(a,s+"-externalImage-active"),i.style&&this.setStyle(i.style)),o||n===t||this.fire("statechange")}},onAdd:function(t){var o=null,i=null,e=this.options,n=e.svgSprite||t.options.svgSprite,s="leaflet-gmx-icon"+(!n||e.regularImageUrl||e.text?"":"Svg"),r=s+"-"+e.id;this._prefix=s;var a=L.DomUtil.create("div",s+" "+r);if(a._id=e.id,this._container=a,e.title&&(a.title=e.title),this.setStyle=function(t){for(var o in t)a.style[o]=t[o]},e.className&&L.DomUtil.addClass(a,e.className),e.regularImageUrl)o=L.DomUtil.create("img","",a),o.src=e.regularImageUrl,this._img=o,L.DomUtil.addClass(a,s+"-img"),L.DomUtil.addClass(a,s+"-externalImage");else if(e.text)L.DomUtil.addClass(a,s+"-text"),i=L.DomUtil.create("span","",a),i.innerHTML=e.text;else if(n){L.DomUtil.addClass(a,"svgIcon");var l="#"+e.id.toLowerCase();a.innerHTML='<svg role="img" class="svgIcon">              <use xlink:href="'+l+'"></use>            </svg>'}else L.DomUtil.addClass(a,s+"-img "+s+"-sprite");e.style&&this.setStyle(e.style),this._iconClick=function(){a.parentNode&&(this.setActive(!this.options.isActive),this.fire("click"),this.options.stateChange&&this.options.stateChange(this))};var h=L.DomEvent.stopPropagation;return L.DomEvent.on(a,"mousemove",h).on(a,"touchstart",h).on(a,"mousedown",h).on(a,"dblclick",h).on(a,"click",h).on(a,"click",this._iconClick,this),e.onAdd&&e.onAdd(this),this.fire("controladd"),t.fire("controladd",this),e.notHide&&(a._notHide=!0),t.gmxControlsManager&&t.gmxControlsManager.add(this),a},onRemove:function(t){t.gmxControlsManager&&t.gmxControlsManager.remove(this),this.fire("controlremove"),t.fire("controlremove",this);var o=this._container,i=L.DomEvent.stopPropagation;L.DomEvent.off(o,"mousemove",i).off(o,"touchstart",i).off(o,"mousedown",i).off(o,"dblclick",i).off(o,"click",i).off(o,"click",this._iconClick,this)},addTo:function(t){return L.Control.prototype.addTo.call(this,t),this.options.addBefore&&this.addBefore(this.options.addBefore),this},addBefore:function(t){var o=this._parent&&this._parent._container;if(o||(o=this._map&&this._map._controlCorners[this.getPosition()]),o)for(var i=0,e=o.childNodes.length;e>i;i++){var n=o.childNodes[i];if(t===n._id){o.insertBefore(this._container,n);break}}else this.options.addBefore=t;return this}}),L.Control.gmxIcon=L.Control.GmxIcon,L.control.gmxIcon=function(t){return new L.Control.GmxIcon(t)},function(){function t(t){return RegExp("msie"+(isNaN(t)?"":"\\s"+t),"i").test(navigator.userAgent)}var o=32;L.Control.GmxIconGroup=L.Control.GmxIcon.extend({options:{position:"topleft",id:"defaultIconGroup",isVertical:!0,isCollapsible:!0,isSortable:!1,singleSelection:!1},addIcon:function(t){return this.items.push(t),t._parent=this,this._map&&(this._container.appendChild(t.onAdd(this._map)),t.options.addBefore&&t.addBefore(t.options.addBefore)),t.on("click",function(){this.setActiveIcon(t)},this),this.options.isCollapsible&&!t.options.skipCollapse&&t.on("click",this._minimize,this),this},removeIcon:function(t){for(var o=0,i=this.items.length;i>o;o++)if(t===this.items[o]){var e=t._container;e.parentNode&&e.parentNode.removeChild(e),this.items.splice(o,1);break}return this},getIconById:function(t){for(var o=0,i=this.items.length;i>o;o++){var e=this.items[o];if(e.options.id===t)return e}return null},setActiveIcon:function(t,o){this.activeIcon="";var i=this.items.length;if(i){if(this.options.singleSelection)for(var e=0;i>e;e++){var n=this.items[e],s=t===n&&(o||n.options.isActive);n.setActive(s),s&&(this.activeIcon=n.options.id)}var r=this._container;if(this.options.isSortable&&t&&r.firstChild&&(r.insertBefore(t._container,r.firstChild),t.options.text&&this._chkTriangleStyle(t._container)),this.triangle){var a=this.options.isSortable?t:this.items[0];a&&a.options.isActive?L.DomUtil.addClass(this.triangle,"triangle-active"):L.DomUtil.removeClass(this.triangle,"triangle-active")}this.fire("activechange",this)}return this},_chkTriangleStyle:function(t){for(var o=this._container,i=0,e=this.items.length;e>i;i++){var n=this.items[i];if(n._container===t){n.options.text&&(this.triangle.style.right=o.clientWidth-t.clientWidth-5+"px",this.triangle.style.left="inherit");break}}},_minimize:function(){var t=this._container.style;t.height=o+"px","auto"!==this.options.width&&(t.width=o+4+"px"),t.overflow="hidden",this.bg&&(this.bg.height=o+2),L.DomUtil.removeClass(this._container,"leaflet-gmx-icon-group-maximum"),this.fire("collapse",this)},_maximize:function(){var t=this._container.style,i=this.options,e=1===this.items.length?o:(o+4)*this.items.length;i.isVertical?(this.bg&&(this.bg.height=e),t.height=e+"px","auto"!==i.width&&(t.width=o+4+"px")):(t.height=o+"px",t.width=e+"px"),t.overflow="unset",L.DomUtil.addClass(this._container,"leaflet-gmx-icon-group-maximum"),this.fire("expand",this)},onAdd:function(i){var e=this.options,n=e.svgSprite||i.options.svgSprite,s="leaflet-gmx-icon-group",r=s+"-"+e.id+(n?" "+s+"Svg":"")+" "+s+(e.isVertical?"-vertical":"-horizontal"),a=L.DomUtil.create("div",s+" "+r);if(e.isVertical){if(t(10)||t(9)){var l=L.DomUtil.create("span","icons-vertical",a),h=L.DomUtil.create("img","",l);h.width=h.height=o,h.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAABBJREFUeNpi+P//PwNAgAEACPwC/tuiTRYAAAAASUVORK5CYII=",this.bg=h,setTimeout(function(){h.width=a.clientWidth},0)}e.isCollapsible&&(n?(this.triangle=L.DomUtil.create("div","triangleSvg",a),this.triangle.innerHTML='<svg role="img" class="svgIcon">						<use xlink:href="#arrow-down"></use>						</svg>'):(this.triangle=L.DomUtil.create("div","triangle leaflet-gmx-icon-sprite",a),this.triangle.width=this.triangle.height=o))}if(this._map=i,this._container=a,a._id=e.id,e.isCollapsible&&(L.DomEvent.on(a,"mousemove",L.DomEvent.stopPropagation).on(a,"mouseout",function(t){for(var o=t.toElement;o;){if(o===a)return;o=o.parentNode}this._minimize()},this).on(a,"mouseover",function(t){for(var o=t.fromElement;o;){if(o===a)return;o=o.parentNode}this._maximize()},this),this._minimize()),this.items=[],e.items.map(this.addIcon,this),e.onAdd&&e.onAdd(this),this.fire("controladd"),i.fire("controladd",this),e.isVertical&&(a.style.marginLeft=0),e.notHide&&(a._notHide=!0),i.gmxControlsManager&&i.gmxControlsManager.add(this),this.items.length){var c=this.items[0],m=this;c.options.text&&setTimeout(function(){m._chkTriangleStyle(c._container)},0)}return a},onRemove:function(t){t.gmxControlsManager&&t.gmxControlsManager.remove(this),this.fire("controlremove"),t.fire("controlremove",this)}}),L.Control.gmxIconGroup=L.Control.GmxIconGroup,L.control.gmxIconGroup=function(t){return new L.Control.GmxIconGroup(t)}}(),function(){var t=["Point","Polygon","Polyline","Rectangle"];L.Control.GmxDrawing=L.Control.GmxIconGroup.extend({options:{position:"topleft",singleSelection:!0,isSortable:!0,id:"drawing",items:null},onAdd:function(o){var i=this;this.setActive=function(t){o.gmxDrawing&&(o.gmxDrawing.bringToFront(),o.gmxDrawing.create(t,i.options.drawOptions))},this.on("activechange",function(o){for(var e=o.activeIcon,n=0,s=t.length;s>n;n++)if(e===t[n])return;i.setActive()}),o.gmxDrawing&&o.gmxDrawing.on("drawstop",function(t){var o=t.object._obj.options||{};o.ctrlKey||o.shiftKey?i.setActive(t.object.options.type):i.setActiveIcon()},this);var e=function(t){return L.control.gmxIcon({id:t,title:i._locale&&"getText"in i._locale?i._locale.getText(t):t,togglable:!0}).on("statechange",function(t){var o=t.target.options,e=o.id;e===i.activeIcon?i.setActive():o.isActive&&i.setActive(e)})},n=this.options.items||t;return this.options.items=[],n.forEach(function(t){i.options.items.push(t instanceof L.Control.GmxIcon?t:e(t))}),L.Control.GmxIconGroup.prototype.onAdd.call(this,o)}}),L.Control.gmxDrawing=L.Control.GmxDrawing,L.control.gmxDrawing=function(t){return new L.Control.GmxDrawing(t)},L.Control.GmxDrawing.locale={},L.Control.GmxDrawing.addInitHook(function(){this._locale=L.Control.GmxDrawing.locale,L.extend(this._locale,L.gmxLocaleMixin)})}(),L.extend(L.Control.GmxDrawing.locale,{rus:{Point:"Маркер",Polygon:"Многоугольник",Polyline:"Линия",Rectangle:"Прямоугольник"}}),L.extend(L.Control.GmxDrawing.locale,{eng:{Point:"Point",Polygon:"Polygon",Polyline:"Polyline",Rectangle:"Rectangle"}}),L.Control.GmxCenter=L.Control.extend({options:{position:"center",id:"center",notHide:!0,color:"#216b9c"},onRemove:function(t){t.gmxControlsManager&&t.gmxControlsManager.remove(this),t.fire("controlremove",this)},onAdd:function(t){var o="leaflet-gmx-center",i="http://www.w3.org/2000/svg",e=L.DomUtil.create("div",o),n=L.DomUtil.create("div",o),s=document.createElementNS(i,"svg"),r=document.createElementNS(i,"g"),a=document.createElementNS(i,"path");return this._container=e,e._id=this.options.id,this.options.notHide&&(e._notHide=!0),a.setAttribute("stroke-width",1),a.setAttribute("stroke-opacity",1),a.setAttribute("d","M6 0L6 12M0 6L12 6"),this._path=a,r.appendChild(a),s.appendChild(r),s.setAttribute("width",12),s.setAttribute("height",12),n.appendChild(s),e.appendChild(n),this.setColor(this.options.color),t.fire("controladd",this),t.gmxControlsManager&&t.gmxControlsManager.add(this),e},setColor:function(t){return this.options.color=t,this._map&&this._path.setAttribute("stroke",t),this}}),L.Control.gmxCenter=L.Control.GmxCenter,L.control.gmxCenter=function(t){return new L.Control.GmxCenter(t)},L.Control.GmxHide=L.Control.GmxIcon.extend({options:{id:"hide",isActive:!0,togglable:!0,notHide:!0,position:"topleft"},setActive:function(t,o){if(this._map){for(var i=this._map._controlContainer,e="leaflet-control-gmx-hidden",n=t?L.DomUtil.removeClass:L.DomUtil.addClass,s=0,r=i.children.length;r>s;s++)for(var a=0,l=i.children[s].children,h=l.length;h>a;a++){var c=l[a];(!c._notHide||o)&&n(c,e)}this.options.isActive=!this.options.isActive;var m=this._container.getElementsByTagName("use");if(m&&m.length){var d=(m[0].getAttribute("xlink:href")||"").replace(/-off$/,"");this.options.isActive||(d+="-off"),m[0].setAttribute("href",d)}this.fire("statechange")}},onAdd:function(t){var o=L.Control.GmxIcon.prototype.onAdd.call(this,t),i="Hide/Show";return L.gmxLocale&&(i=L.gmxLocale.addText({eng:{hide:i},rus:{hide:"Скрыть/Показать"}}).getText("hide")),o._id=this.options.id,o.title=i,o._notHide=this.options.notHide,o}}),L.Control.gmxHide=L.Control.GmxHide,L.control.gmxHide=function(t){return new L.Control.GmxHide(t)},L.Control.GmxLayers=L.Control.Layers.extend({options:{collapsed:!1,autoZIndex:!1,id:"layers"},initialize:function(t,o){L.setOptions(this,o),this._layerControlInputs=[],this._layers={},this._lastZIndex=0,this._handlingClick=!1,this._blm=t,L.extend(this,{_onBaseLayerActiveIDs:function(t){var o,i;for(o in this._layers)this._layers[o].overlay||delete this._layers[o];for(o=0,i=t.activeIDs.length;i>o;o++)this._addBaseLayer(this._blm.get(t.activeIDs[o]),!0);return this._update(),!0},_onBaseLayerChange:function(t){t.baseLayer&&this.setActiveBaseLayer(t.baseLayer.id)},_onBaseLayerOptionsChange:function(t){this._addBaseLayer(t.baseLayer)}})},addBaseLayer:function(){return console.log("Warning: Use `gmxBaseLayersManager.add` instead `addBaseLayer`!"),this},_addLayer:function(){},_addBaseLayer:function(t,o){return t&&(this._addLayer(t,t.options[L.gmxLocale.getLanguage()]||t.id),o||this._update()),this},_addItemObject:function(t){var o=this._addItem(t);t.layer&&t.layer._gmx&&t.layer._gmx.layerID&&(o.className="_"+t.layer._gmx.layerID)},_update:function(){if(this._container){this._layerControlInputs=[],this._baseLayersList.innerHTML="",this._overlaysList.innerHTML="";var t,o,i,e=!1,n=!1,s=this._blm.getActiveIDs(),r={};for(t in this._layers)i=this._layers[t],i.overlay?(this._addItemObject(i),n=!0):(r[i.layer.id]=i,e=!0);for(t=0,o=s.length;o>t;t++)r[s[t]]&&this._addItemObject(r[s[t]]);this.options.hideBaseLayers&&(e=!1,this._baseLayersList.style.display="none"),this._separator.style.display=n&&e?"":"none",this._container.style.display=n||e?"":"none"}},onAdd:function(t){var o=L.Control.Layers.prototype.onAdd.call(this,t);this._container=o,o.id=this.options.id,"activeBaseLayerInput"in this||(this.activeBaseLayerInput=this.getActiveBaseLayer(!0)),L.DomEvent.on(o,"mousemove",L.DomEvent.stopPropagation),t.gmxLayersControl=this,t.fire("controladd",this),this._blm.on("baselayeroptionschange baselayeradd",this._onBaseLayerOptionsChange,this).on("baselayeractiveids",this._onBaseLayerActiveIDs,this).on("baselayerchange",this._onBaseLayerChange,this);var i=this;this._blm.getActiveIDs().map(function(t){i._addBaseLayer(i._blm.get(t))});var e=this._blm.getCurrentID();return e&&this.setActiveBaseLayer(e),t.gmxControlsManager&&t.gmxControlsManager.add(this),o},onRemove:function(t){t.gmxControlsManager&&t.gmxControlsManager.remove(this),L.Control.Layers.prototype.onRemove.call(this,t),this._blm.off("baselayeroptionschange baselayeradd",this._onBaseLayerOptionsChange,this).off("baselayeractiveids",this._onBaseLayerActiveIDs,this).off("baselayerchange",this._onBaseLayerChange,this),t.fire("controlremove",this)},unSetActiveBaseLayer:function(t){this._toogleActiveBaseLayer(t,!1)},setActiveBaseLayer:function(t){this._toogleActiveBaseLayer(t,!0)},_toogleActiveBaseLayer:function(t,o){for(var i=null,e=this._form.getElementsByTagName("input"),n=null,s=this._getLayerByName(t),r=s&&s.layer._leaflet_id,a=s&&s.overlay,l=0,h=e.length;h>l;l++){var c=e[l],m=c.layerId,d=this._layers[m],g=d.layer,p=this._map.hasLayer(g),u=d.overlay||!1;if(u){if(r===m)return o?p||this._map.addLayer(g):p&&this._map.removeLayer(g),this}else a||r===m&&(o?i=c:p&&(c.checked=!1,i=null,this._map.removeLayer(g)),n=c)}return i&&n&&(this._map.addLayer(this._layers[n.layerId].layer),n.checked=!0),this.activeBaseLayerInput=i,this},getActiveBaseLayer:function(t){for(var o=this._form.getElementsByTagName("input"),i=0,e=o.length;e>i;i++){var n=o[i];if(n.checked){if(t)return n;var s=n.layerId,r=this._layers[s];if(!r.overlay)return r.name}}return null},_getLayerByName:function(t){for(var o in this._layers){var i=this._layers[o];if(t===i.name||t===i.layer.id)return i}return null},_onInputClick:function(t){if(t){var o=t.target,i=this._layers[o.layerId].name,e=this._getLayerByName(i),n=this.activeBaseLayerInput&&o.layerId===this.activeBaseLayerInput.layerId?!1:o.checked;this._handlingClick=!0,n&&e&&!e.overlay?this._blm.setCurrentID(e.layer.id):this._toogleActiveBaseLayer(i,n),this._handlingClick=!1,this._refocusOnMap()}}}),L.Control.gmxLayers=L.Control.GmxLayers,L.control.gmxLayers=function(t,o){return new L.Control.GmxLayers(t,o)},function(){var t={eng:{gmxLocation:{locationChange:"Сhange the map center:",locationTxt:"Current center coordinates",coordFormatChange:"Toggle coordinates format",scaleBarChange:"Toggle scale bar format"}},rus:{gmxLocation:{locationChange:"Переместить центр карты:",locationTxt:"Текущие координаты центра карты",coordFormatChange:"Сменить формат координат",scaleBarChange:"Сменить формат масштаба"}}},o=function(o){var i="";if(L.gmxLocale)i=L.gmxLocale.getText(o);else{var e=o.split(".");i=t.eng.gmxLocation[e[e.length-1]]}return i||""},i=["M 1:500 000 000","M 1:300 000 000","M 1:150 000 000","M 1:80 000 000","M 1:40 000 000","M 1:20 000 000","M 1:10 000 000","M 1:5 000 000","M 1:2500 000","M 1:1 000 000","M 1:500 000","M 1:300 000","M 1:150 000","M 1:80 000","M 1:40 000","M 1:20 000","M 1:10 000","M 1:5 000","M 1:2 500","M 1:1 250","M 1:625"],e=["",""," (EPSG:3395)"," (EPSG:3857)"];L.Control.GmxLocation=L.Control.extend({includes:L.Evented?L.Evented.prototype:L.Mixin.Events,options:{position:"gmxbottomright",id:"location",gmxPopup:"internal",notHide:!0,coordinatesFormat:0,scaleFormat:"bar"},setScaleFormat:function(t){this.options.scaleFormat="bar"===t?"bar":"text",this.scaleBar.style.visibility="bar"===t?"visible":"hidden",this._checkPositionChanged()},onAdd:function(n){var s="leaflet-gmx-location",r=L.DomUtil.create("div",s),a=L.Control.GmxLocation.Utils,l=this;this._container=r,r._id=this.options.id,this.options.notHide&&(r._notHide=!0),L.gmxLocale&&L.gmxLocale.addText(t),this.prevCoordinates="";var h=n._controlCorners[this.options.position];if(h){this._window=L.DomUtil.create("div","leaflet-gmx-location-window",r),this._window.style.display="none";var c=L.DomUtil.create("div","closeButton",this._window);c.innerHTML="&#215;",L.DomEvent.disableClickPropagation(this._window),L.DomEvent.on(this._window,"contextmenu",L.DomEvent.fakeStop||L.DomEvent._fakeStop),L.DomEvent.on(c,"click",function(){var t=l._window.style;t.display="none"===t.display?"block":"none"},this),n.on("click",function(){l._window.style.display="none"},this),this._windowContent=L.DomUtil.create("div","windowContent",this._window)}this.locationTxt=L.DomUtil.create("span","leaflet-gmx-locationTxt",r),this.locationTxt.title=o("gmxLocation.locationTxt"),this.coordFormatChange=L.DomUtil.create("span","leaflet-gmx-coordFormatChange",r),this.coordFormatChange.title=o("gmxLocation.coordFormatChange"),this.scaleBar=L.DomUtil.create("span","leaflet-gmx-scaleBar",r),this.scaleBarTxt=L.DomUtil.create("span","leaflet-gmx-scaleBarTxt",r),this.scaleBarTxt.title=this.scaleBar.title=o("gmxLocation.scaleBarChange"),this._map=n;var m={coordFormat:this.options.coordinatesFormat||0,len:e.length,setCoordinatesFormat:function(t){t=t||this.coordFormat||0,0>t?t=m.len-1:t>=m.len&&(t=0),this.coordFormat=t;var o=a.getCoordinatesString(l._map.getCenter(),this.coordFormat);o&&l.prevCoordinates!==o&&(l.locationTxt.innerHTML=o),l.prevCoordinates=o,this._redrawTimer&&clearTimeout(this._redrawTimer),this._redrawTimer=setTimeout(function(){l._map&&l._map.fire("onChangeLocationSize",{locationSize:r.clientWidth})},100),l.fire("coordinatesformatchange",{coordinatesFormat:this.coordFormat})},goTo:function(t){var o=L.Control.gmxLocation.Utils.parseCoordinates(t);l._map.panTo(o)},showCoordinates:function(t){var i=a.getCoordinatesString(l._map.getCenter(),this.coordFormat);if(l.options.onCoordinatesClick)l.options.onCoordinatesClick(i,t);else if(L.control.gmxPopup){var e=L.DomUtil.create("div","gmxLocation-popup"),n=L.DomUtil.create("div","",e),s=L.DomUtil.create("input","gmxLocation-input",e),r=L.DomUtil.create("button","",e);if(r.innerHTML="Ok",L.DomEvent.on(r,"click",function(){m.goTo(s.value)}),n.innerHTML=o("gmxLocation.locationChange"),s.value=i,L.DomEvent.on(s,"keydown",function(t){13===t.which&&m.goTo(this.value)}),"internal"===l.options.gmxPopup&&l._window){l._windowContent.innerHTML="",l._windowContent.appendChild(e);var h=l._window.style;h.display="none"===h.display?"block":"none"}else{var c={};if("tip"===l.options.gmxPopup){var d=l._map.mouseEventToContainerPoint(t);c={tip:!0,anchor:new L.Point(d.x,d.y-5)}}L.control.gmxPopup(c).setContent(e).openOn(l._map)}}else{var g=window.prompt(l.locationTxt.title+":",i);if(g&&g!==i){var p=a.parseCoordinates(g);p&&l._map.panTo(p)}}},nextCoordinatesFormat:function(){this.coordFormat+=1,this.setCoordinatesFormat(this.coordFormat||0)}};this.getCoordinatesFormat=function(){return m.coordFormat},this._checkPositionChanged=function(){var t=n.getZoom();if(t){var o={txt:i[t],width:0};if("bar"===this.options.scaleFormat&&(o=a.getScaleBarDistance(t,n.getCenter())),!o||o.txt===l._scaleBarText&&o.width===l._scaleBarWidth)return;l._scaleBarText=o.txt,l._scaleBarWidth=o.width,l._scaleBarText&&(l.scaleBar.style.width=l._scaleBarWidth+"px",l.scaleBarTxt.innerHTML=l._scaleBarText),m.setCoordinatesFormat(m.coordFormat||0)}},this._setCoordinatesFormat=function(){m.setCoordinatesFormat(m.coordFormat||0)},this.setCoordinatesFormat=function(t){0===t&&(m.coordFormat=0),m.setCoordinatesFormat(t)};var d=function(){this.setScaleFormat("bar"===this.options.scaleFormat?"text":"bar")};return this._toggleHandlers=function(t){var o=t?"on":"off",i=L.DomEvent[o],e=L.DomEvent.stopPropagation;i(r,"mousemove",e),i(this.coordFormatChange,"click",e),i(this.coordFormatChange,"click",m.nextCoordinatesFormat,m),i(this.locationTxt,"click",e),i(this.locationTxt,"click",m.showCoordinates,m),i(this.scaleBarTxt,"click",e),i(this.scaleBarTxt,"click",d,this),i(this.scaleBar,"click",e),i(this.scaleBar,"click",d,this),L.Browser.mobile||L.Browser.ie||(i(this.coordFormatChange,"dblclick",e),i(this.scaleBarTxt,"dblclick",e),i(this.scaleBar,"dblclick",e)),n[o]("moveend",this._checkPositionChanged,this),n[o]("move",this._setCoordinatesFormat,this)},this._toggleHandlers(!0),this.setScaleFormat(this.options.scaleFormat),this._checkPositionChanged(),n.fire("controladd",this),n.gmxControlsManager&&n.gmxControlsManager.add(this),r},onRemove:function(t){t.gmxControlsManager&&t.gmxControlsManager.remove(this),t.fire("controlremove",this),this.prevCoordinates=this._scaleBarText=null,this._toggleHandlers(!1)}});var n={getScaleBarDistance:function(t,o){for(var i=L.Projection.Mercator.project(o),e=L.Projection.Mercator.unproject(new L.Point(i.x+40,i.y+30)),n=156543.033928041*Math.pow(2,-t)*this.distVincenty(o.lng,o.lat,e.lng,e.lat)/50,s=0;30>s;s++){var r=[1,2,5][s%3]*Math.pow(10,Math.floor(s/3)),a=Math.floor(r/n);if(a>50)return{txt:this.prettifyDistance(r),width:a}}return null}};L.gmxUtil?(n.getCoordinatesString=L.gmxUtil.getCoordinatesString,n.prettifyDistance=L.gmxUtil.prettifyDistance,n.formatDegrees=L.gmxUtil.formatDegrees,n.pad2=L.gmxUtil.pad2,n.trunc=L.gmxUtil.trunc,n.latLonFormatCoordinates=L.gmxUtil.latLonFormatCoordinates,n.latLonFormatCoordinates2=L.gmxUtil.latLonFormatCoordinates2,n.degRad=L.gmxUtil.degRad,n.distVincenty=L.gmxUtil.distVincenty,n.parseCoordinates=L.gmxUtil.parseCoordinates):(n.prettifyDistance=function(t){var i="",e=o("units.km")||"km",n=" "+e;return"km"===i?Math.round(t)/1e3+n:2e3>t||"m"===i?(e=o("units.m")||"m",Math.round(t)+" "+e):2e5>t?Math.round(t/10)/100+n:Math.round(t/1e3)+n},n.formatDegrees=function(t){t=Math.round(1e7*t)/1e7+1e-8;var o=Math.floor(t),i=Math.floor(60*(t-o)),e=this.pad2(3600*(t-o-i/60)).substring(0,2);return this.pad2(o)+"°"+this.pad2(i)+"'"+e+'"'},n.pad2=function(t){return 10>t?"0"+t:""+t},n.trunc=function(t){return(""+(Math.round(1e7*t)/1e7+1e-8)).substring(0,9)},n.latLonFormatCoordinates=function(t,o){return this.formatDegrees(Math.abs(o))+(o>0?" N, ":" S, ")+this.formatDegrees(Math.abs(t))+(t>0?" E":" W")},n.latLonFormatCoordinates2=function(t,o){return this.trunc(Math.abs(o))+(o>0?" N, ":" S, ")+this.trunc(Math.abs(t))+(t>0?" E":" W")},n.degRad=function(t){return t*(Math.PI/180)},n.distVincenty=function(t,o,i,e){var n={},s={};n.lon=this.degRad(t),n.lat=this.degRad(o),s.lon=this.degRad(i),s.lat=this.degRad(e);for(var r=6378137,a=6356752.3142,l=1/298.257223563,h=s.lon-n.lon,c=Math.atan((1-l)*Math.tan(n.lat)),m=Math.atan((1-l)*Math.tan(s.lat)),d=Math.sin(c),g=Math.cos(c),p=Math.sin(m),u=Math.cos(m),f=h,_=2*Math.PI,L=20;Math.abs(f-_)>1e-12&&--L>0;){var v=Math.sin(f),x=Math.cos(f),C=Math.sqrt(u*v*u*v+(g*p-d*u*x)*(g*p-d*u*x));if(0===C)return 0;var y=d*p+g*u*x,w=Math.atan2(C,y),b=g*u*v/C,D=1-b*b,M=y-2*d*p/D;isNaN(M)&&(M=0);var k=l/16*D*(4+l*(4-3*D));_=f,f=h+(1-k)*l*b*(w+k*C*(M+k*y*(-1+2*M*M)))}if(0===L)return 0/0;var B=D*(r*r-a*a)/(a*a),S=1+B/16384*(4096+B*(-768+B*(320-175*B))),U=B/1024*(256+B*(-128+B*(74-47*B))),A=U*C*(M+U/4*(y*(-1+2*M*M)-U/6*M*(-3+4*C*C)*(-3+4*M*M))),I=a*S*(w-A);return I=I.toFixed(3)},n.parseCoordinates=function(t){var o=null,i=/\(EPSG:(\d+)\)/g,e=i.exec(t);if(e&&(o=e[1],t=t.replace(i,"")),t.match(/[йцукенгшщзхъфывапролджэячсмитьбюЙЦУКЕНГШЩЗХЪФЫВАПРОЛДЖЭЯЧСМИТЬБЮqrtyuiopadfghjklzxcvbmQRTYUIOPADFGHJKLZXCVBM_:]/))return null;if(-1===t.indexOf(" ")&&-1===t.indexOf(","))return null;-1!==t.indexOf(" ")&&(t=t.replace(/,/g,"."));var n=[];for(i=/(-?\d+(\.\d+)?)([^\d\-]*)/g,e=i.exec(t);e;)n.push(e[1]),e=i.exec(t);if(n.length<2)return null;var s,r=Math.floor(n.length/2),a=0,l=1;for(s=0;r>s;s++)a+=parseFloat(n[s])*l,l/=60;var h=0;for(l=1,s=r;s<n.length;s++)h+=parseFloat(n[s])*l,l/=60;Math.max(t.indexOf("N"),t.indexOf("S"))>Math.max(t.indexOf("E"),t.indexOf("W"))&&(e=h,h=a,a=e);var c;return"3857"===o&&(c=L.Projection.SphericalMercator.unproject(new L.Point(a,h)._divideBy(6378137)),h=c.lng,a=c.lat),(Math.abs(h)>180||Math.abs(a)>180)&&(c=L.Projection.Mercator.unproject(new L.Point(a,h)),h=c.lng,a=c.lat),-1!==t.indexOf("W")&&(h=-h),-1!==t.indexOf("S")&&(a=-a),[a,h]},n.getCoordinatesString=function(t,o){var i,s=t.lng,r=t.lat,a=e,l=a.length,h="";return o=o||0,s>180&&(s-=360),-180>s&&(s+=360),0===o%l?h=n.latLonFormatCoordinates2(s,r):1===o%l?h=n.latLonFormatCoordinates(s,r):2===o%l?(i=L.Projection.Mercator.project(new L.LatLng(r,s)),h=""+Math.round(i.x)+", "+Math.round(i.y)+a[2]):(i=L.CRS.EPSG3857.project(new L.LatLng(r,s)),h=""+Math.round(i.x)+", "+Math.round(i.y)+a[3]),h}),L.Control.GmxLocation.Utils=n,L.Control.gmxLocation=L.Control.GmxLocation,L.control.gmxLocation=function(t){return new L.Control.GmxLocation(t)}}(),L.Control.GmxPopup=L.Control.extend({options:{position:"center",id:"gmxPopup",className:"gmxControlPopup",draggable:!0},onAdd:function(t){return this._map=t,this._container||this._initLayout(),t.on("click",this.remove,this),this._container},openOn:function(t){return t.addControl(this),this.update(),this},remove:function(){return this._map&&(this._map.off("click",this.remove,this),L.Control.prototype.remove?L.Control.prototype.remove.call(this):this._map.removeControl(this)),this},setContent:function(t){return this._content=t,this.update(),this},update:function(){return this._container?(this._container.style.visibility="hidden",this._updateContent(),this._updateLayout(),this._updatePosition(),this._container.style.visibility="",this):void 0},_updateContent:function(){if(this._content)if("string"==typeof this._content)this._contentNode.innerHTML=this._content;else{for(;this._contentNode.hasChildNodes();)this._contentNode.removeChild(this._contentNode.firstChild);this._contentNode.appendChild(this._content)}},_updateLayout:function(){var t=this._contentNode,o=t.style;o.width="",o.whiteSpace="nowrap";var i=t.offsetWidth;i=Math.min(i,this.options.maxWidth),i=Math.max(i,this.options.minWidth),o.width=i+1+"px",o.whiteSpace="",o.height="";var e=t.offsetHeight,n=this.options.maxHeight,s="leaflet-popup-scrolled";n&&e>n?(o.height=n+"px",L.DomUtil.addClass(t,s)):L.DomUtil.removeClass(t,s),this._containerWidth=this._container.offsetWidth},_updatePosition:function(){if(this._map){var t=new L.Point(this._container.clientWidth,this._container.clientHeight),o=this.options.anchor&&this.options.anchor._subtract(L.point(10,this._container.clientHeight))||this._map.getSize()._divideBy(2),i=o._subtract(t._divideBy(2));L.DomUtil.setPosition(this._container,i)}},_initLayout:function(){var t=this._container=L.DomUtil.create("div",this.options.className),o=L.DomUtil.create("div","closeButton",t);o.innerHTML="&#215;",L.DomEvent.disableClickPropagation(o),L.DomEvent.disableClickPropagation(t),L.DomEvent.on(o,"click",this.remove,this),this.options.draggable&&(new L.Draggable(t).enable(),t.style.cursor="move");var i=L.DomUtil.create("div","content-wrapper",t);L.DomEvent.disableClickPropagation(i),this._contentNode=L.DomUtil.create("div","content",i),L.DomEvent.disableScrollPropagation(this._contentNode),L.DomEvent.on(i,"contextmenu",L.DomEvent.stopPropagation),this.options.tip&&(this._tipContainer=L.DomUtil.create("div","tip-container",t),this._tip=L.DomUtil.create("div","tip",this._tipContainer))}}),L.control.gmxPopup=function(t){return new L.Control.GmxPopup(t)},function(){var t=function(t){var o=L.gmxLocale?L.gmxLocale.getText(t):null;return o||""};L.Control.GmxCopyright=L.Control.extend({options:{position:"gmxbottomleft",type:"window",closeButton:!1,notHide:!0,cursorPosition:!1,mapCopyright:"",scanexCopyright:'<a target="_blank" href="http://kosmosnimki.ru/terms.html">&copy; 2007-'+(new Date).getUTCFullYear()+" RDC ScanEx</a> - Terms of Service",leafletCopyright:'<a target="_blank" href="http://leafletjs.com">&copy; Leaflet</a>',id:"copyright"},onAdd:function(o){if(L.gmxLocale&&L.gmxLocale.addText({eng:{gmxCopyright:{showHide:"Show/Hide copyrights"}},rus:{gmxCopyright:{showHide:"Показать/Скрыть копирайты"}}}),this._currentText="",this._container=L.DomUtil.create("span","leaflet-gmx-copyright"),this.options.notHide&&(this._container._notHide=!0),this._container._id=this.options.id,this._window=L.DomUtil.create("div","leaflet-gmx-copyright-window",this._container),this.options.closeButton){var i=L.DomUtil.create("div","closeButton",this._window);i.innerHTML="&#215;",L.DomEvent.on(i,"click",this.toggleWindow,this)}if(this._windowContent=L.DomUtil.create("div","windowContent",this._window),L.DomEvent.on(this._window,"contextmenu",L.DomEvent.fakeStop||L.DomEvent._fakeStop),this._copyrights=L.DomUtil.create("span","leaflet-gmx-copyrights",this._container),this.options.cursorPosition){var e=L.gmxUtil||(L.Control.GmxLocation?L.Control.GmxLocation.Utils:null),n=o.gmxControlsManager.get("location")||null;if(e){var s=L.DomUtil.create("span","leaflet-gmx-cursorposition",this._container);this.lastLatLng=L.latLng(0,0),this.cursorPosition=function(t){var o=t.latlng,i=L.Browser.webkit?t.originalEvent.which:t.originalEvent.buttons;i||o.equals(this.lastLatLng)||(this.lastLatLng=o,s.innerHTML=e.getCoordinatesString(o,n?n.getCoordinatesFormat():0))},o.on("mousemove",this.cursorPosition,this)}}this.setFormat=function(o){"window"===o?(this._copyrights.title=t("gmxCopyright.showHide"),this._copyrights.innerHTML="© Copyrights",this._container.style.width="auto"):this._copyrights.title="",this.options.type=o,this.toggleWindow(),this._window.style.display="none"},this.setFormat(this.options.type);var r=L.DomEvent.stopPropagation;return L.DomEvent.on(this._window,"dblclick",r).on(this._window,"click",r).on(this._container,"mousemove",r).on(this._copyrights,"dblclick",r).on(this._copyrights,"click",r).on(this._copyrights,"click",this.toggleWindow,this),o.on("click",this.closeWindow,this).on("onChangeLocationSize",this._chkWidth,this).on("moveend",this._redraw,this).on("layeradd",this._redraw,this).on("layerremove",this._redraw,this),this._redraw(),o.fire("controladd",this),o.gmxControlsManager&&o.gmxControlsManager.add(this),this._container
},onRemove:function(t){t.gmxControlsManager&&t.gmxControlsManager.remove(this),t.fire("controlremove",this);var o=L.DomEvent.stopPropagation;L.DomEvent.off(this._window,"dblclick",o).off(this._window,"click",o).off(this._container,"mousemove",o).off(this._copyrights,"dblclick",o).off(this._copyrights,"click",o).off(this._copyrights,"click",this.toggleWindow,this),t.off("click",this.closeWindow,this).off("onChangeLocationSize",this._chkWidth,this).off("moveend",this._redraw,this).off("layeradd",this._redraw,this).off("layerremove",this._redraw,this),this.cursorPosition&&t.off("mousemove",this.cursorPosition,this)},toggleWindow:function(){this.setWindowVisible("none"===this._window.style.display?!0:!1)},closeWindow:function(){this.setWindowVisible(!1)},setWindowVisible:function(t){if("window"===this.options.type){var o=this._window.style;o.display=t?"block":"none",this._currentText="",this._redraw()}},_chkWidth:function(t){if("window"!==this.options.type){var o=this._map._size.x-t.locationSize-25;this._container.style.width=(o>0?o:0)+"px"}},setMapCopyright:function(t){this.options.mapCopyright=t||"",this._redraw()},_redrawItems:function(){var t='<a target="_blank"',o=[],i=this._map._layers,e=this._map._zoom,n=this._map.getBounds(),s=[],r={};this.options.scanexCopyright&&o.push(this.options.scanexCopyright),this.options.mapCopyright&&o.push(this.options.mapCopyright);for(var a in i)i[a].options&&s.push(i[a].options);s=s.sort(function(t,o){return t.zIndex-o.zIndex}),s.forEach(function(i){var s=i.attribution;s&&!r[s]&&(r[s]=!0,o.push(s.split("<a").join(t))),i.gmxCopyright&&i.gmxCopyright.forEach(function(i){var s=i.attribution;r[s]||e<i.minZoom||e>i.maxZoom||(!i.bounds||(i.bounds instanceof L.LatLngBounds||(i.bounds=L.latLngBounds(i.bounds)),n.intersects(i.bounds)))&&(r[s]=!0,o.push(s.split("<a").join(t)))})}),this.options.leafletCopyright&&o.push(this.options.leafletCopyright);var l=o.join(" ");this._currentText!==l&&(this._currentText=l,"window"===this.options.type?this._windowContent.innerHTML=o.join("<br>"):this._copyrights.innerHTML=l)},_redraw:function(){var t=this;this._redrawTimer&&clearTimeout(this._redrawTimer),this._redrawTimer=setTimeout(function(){t._redrawTimer=null,t._map&&t._redrawItems()},100)}}),L.Control.gmxCopyright=L.Control.GmxCopyright,L.control.gmxCopyright=function(t){return new L.Control.GmxCopyright(t)}}(),L.Control.GmxZoom=L.Control.Zoom.extend({options:{position:"topleft",id:"zoom",zoomslider:!0},_stepY:7,_minY:9,_maxY:9,onAdd:function(t){var o="leaflet-gmx",i=L.DomUtil.create("div",o+"-zoomParent"),e=this.options,n=e.svgSprite||t.options.svgSprite;this._container=i,i._id=e.id,i._isZoomControl=!0,this._map=t,this._zoomPlaque=L.DomUtil.create("div",o+"-zoomPlaque",i);var s="Zoom in",r="Zoom out";L.gmxLocale&&(L.gmxLocale.addText({eng:{"Zoom in":"Zoom in","Zoom out":"Zoom out"},rus:{"Zoom in":"Увеличить","Zoom out":"Уменьшить"}}),s=L.gmxLocale.getText("Zoom in"),r=L.gmxLocale.getText("Zoom out"));var a=n?o+"-iconSvg":o+"-icon "+o+"-icon-img "+o+"-icon-sprite";return this._zoomInButton=this._createDiv(i,o+(n?"Svg":"")+"-zoom-in "+a,s,this._zoomIn,this),this._zoomOutButton=this._createDiv(i,o+(n?"Svg":"")+"-zoom-out "+a,r,this._zoomOut,this),n&&(L.DomUtil.addClass(this._zoomInButton,"svgIcon"),this._zoomInButton.innerHTML='<svg role="img" class="svgIcon"><use xlink:href="#zoom-in"></use></svg>',L.DomUtil.addClass(this._zoomOutButton,"svgIcon"),this._zoomOutButton.innerHTML='<svg role="img" class="svgIcon"><use xlink:href="#zoom-out"></use></svg>'),t.on("zoomend zoomlevelschange",this._updateDisabled,this),e.zoomslider&&this._chkZoomLevelsChange(i),t.fire("controladd",this),t.gmxControlsManager&&t.gmxControlsManager.add(this),i},onRemove:function(t){t.gmxControlsManager&&t.gmxControlsManager.remove(this),t.fire("controlremove",this),L.Control.Zoom.prototype.onRemove.call(this,t)},_createDiv:function(t,o,i,e,n){var s=L.DomUtil.create("div",o,t);i&&(s.title=i);var r=L.DomEvent.stopPropagation;return L.DomEvent.on(s,"click",r).on(s,"mousedown",r).on(s,"dblclick",r).on(s,"click",L.DomEvent.preventDefault).on(s,"click",e||r,n),s},_setPosition:function(){if(this._zoomVal){var t=this._map.getMinZoom(),o=this._maxY-(this._zoom-t)*this._stepY;this._zoomVal.innerHTML=this._zoom,L.DomUtil.setPosition(this._zoomPointer,L.point(4,o))}},_getZoomByY:function(t){return t<this._minY?t=this._minY:t>this._maxY&&(t=this._maxY),Math.floor((this._maxY-t)/this._stepY)},_setSliderSize:function(){var t=this._map,o=this._stepY*(t.getMaxZoom()-t.getMinZoom()+1);this._maxY=o+3,this._zoomSliderBG.style.height=o+"px",o+=72,"block"!==this._zoomSliderCont.style.display?(this._zoomPlaque.style.display="none",o=68):this._zoomPlaque.style.display="block",this._zoomPlaque.style.height=o+"px"},_chkZoomLevelsChange:function(t){var o=this,i=this._map,e="leaflet-gmx",n=i.getMinZoom(),s=i.getMaxZoom();if(n!==this._MinZoom||s!==this._MaxZoom){var r=s-n;if(100>s&&r>=0){if(!this._zoomSliderCont){this._zoomSliderCont=this._createDiv(t,e+"-sliderCont"),this._zoomSliderBG=this._createDiv(this._zoomSliderCont,e+"-sliderBG"),L.DomEvent.on(this._zoomSliderBG,"click",function(t){this._zoom=this._getZoomByY(t.layerY)+i.getMinZoom(),this._map.setZoom(this._zoom),this._zoomPointer.style.display=this._zoom===i._limitZoom(this._zoom)?"block":"none"},this),this._zoomPointer=this._createDiv(this._zoomSliderCont,e+"-zoomPointer "),this._zoomVal=this._createDiv(this._zoomPointer,e+"-zoomVal "+e+"-icon-sprite"),L.DomEvent.on(t,"mouseover",function(){var t=i.getZoom();this._zoomPointer.style.display=t===i._limitZoom(t)?"block":"none",1/0!==i.getMaxZoom()&&(this._zoomSliderCont.style.display="block",this._setSliderSize())},this);var a=function(){o._zoomSliderCont.style.display="none",o._setSliderSize()};L.DomEvent.on(t,"mouseout",function(){this._draggable._moving||a()},this);var l=new L.Draggable(this._zoomPointer);l.on("dragstart",function(){},this),l.on("drag",function(t){var o=t.target._newPos;this._zoom=this._getZoomByY(o.y)+i.getMinZoom(),this._setPosition()},this),l.on("dragend",function(){this._map.setZoom(this._zoom),a()},this),l.enable(),this._draggable=l}this._setSliderSize()}this._MinZoom=n,this._MaxZoom=s}this._zoom=i._zoom,this._setPosition()},_updateDisabled:function(t){L.Control.Zoom.prototype._updateDisabled.call(this,t),this._zoom=this._map._zoom,this.options.zoomslider&&("zoomlevelschange"===t.type&&this._chkZoomLevelsChange(this._container),this._setPosition())},setVisible:function(t){this._container&&(this._container.style.display=t?"block":"none")}}),L.Control.gmxZoom=L.Control.GmxZoom,L.control.gmxZoom=function(t){return new L.Control.GmxZoom(t)},L.Control.GmxBottom=L.Control.extend({options:{position:"bottom",notHide:!0,id:"bottom"},onRemove:function(t){t.gmxControlsManager&&t.gmxControlsManager.remove(this),t.fire("controlremove",this);var o=t._controlCorners;["bottomleft","bottomright","right","left"].map(function(t){o[t]&&L.DomUtil.removeClass(o[t],"gmx-bottom-shift")})},onAdd:function(t){var o="leaflet-gmx-copyright-location",i=L.DomUtil.create("div",o);this._container=i,i._id=this.options.id,this.options.notHide&&(i._notHide=!0),L.DomEvent.on(i,"mousemove",L.DomEvent.stopPropagation).on(this._map._controlContainer,"dblclick",L.DomEvent.stopPropagation),L.DomUtil.create("div",o+"-bg",i),t.fire("controladd",this);var e=t._controlCorners;return["bottomleft","bottomright","right","left"].map(function(t){e[t]&&L.DomUtil.addClass(e[t],"gmx-bottom-shift")}),t.gmxControlsManager&&t.gmxControlsManager.add(this),i}}),L.Control.gmxBottom=L.Control.GmxBottom,L.control.gmxBottom=function(t){return new L.Control.GmxBottom(t)},L.Control.GmxLogo=L.Control.extend({options:{position:"gmxbottomcenter",notHide:!0,id:"logo"},onAdd:function(t){var o=L.DomUtil.create("a","");this._container=o,this.options.notHide&&(o._notHide=!0),o.id=this.options.id,o.setAttribute("href","http://geomixer.ru"),o.setAttribute("target","_blank"),this._logoPrefix="leaflet-gmx-logo"+(this.options.type?"-"+this.options.type:"");var i=this._logoPrefix+"-shift";return this._shift=!1,this._updatePosition=function(t){if(o.parentNode){var e=(o.clientWidth-o.parentNode.clientWidth)/2+t.locationSize>0?!0:!1;this._shift!==e&&(this._shift=e,e?L.DomUtil.addClass(o,i):L.DomUtil.removeClass(o,i))}},t.fire("controladd",this),t.gmxControlsManager&&t.gmxControlsManager.add(this),o},onRemove:function(t){t.gmxControlsManager&&t.gmxControlsManager.remove(this),t.fire("controlremove",this),t.off("onChangeLocationSize",this._updatePosition,this)},addTo:function(t){return L.Control.prototype.addTo.call(this,t),L.DomUtil.addClass(this._container,this._logoPrefix),t.on("onChangeLocationSize",this._updatePosition,this),this}}),L.Control.gmxLogo=L.Control.GmxLogo,L.control.gmxLogo=function(t){return new L.Control.GmxLogo(t)},L.Map.addInitHook(function(){this._controlCorners.bottom||(this._controlCorners.bottom=L.DomUtil.create("div","leaflet-bottom leaflet-left leaflet-right",this._controlContainer))}),L.Control.GmxSidebar=L.Control.extend({options:{id:"defaultSidebar",position:"right"},onAdd:function(t){var o=document.createElement("div");return this._container=o,o._id=this.options.id,o.className="leaflet-gmx-sidebar","number"==typeof this.options.width&&o.setAttribute("style","width: "+this.options.width+"px"),"string"==typeof this.options.className&&L.DomUtil.addClass(o,this.options.className),L.DomEvent.on(o,"mousemove",L.DomEvent.stopPropagation).on(o,"dblclick",L.DomEvent.stopPropagation),t.gmxControlsManager&&t.gmxControlsManager.add(this),o},onRemove:function(t){t.gmxControlsManager&&t.gmxControlsManager.remove(this),t.fire("controlremove",this)},expand:function(){L.DomUtil.addClass(this._container,"leaflet-gmx-sidebar_expanded")},collapse:function(){L.DomUtil.removeClass(this._container,"leaflet-gmx-sidebar_expanded")},isExpanded:function(){return L.DomUtil.hasClass(this._container,"leaflet-gmx-sidebar_expanded")},getContentContainer:function(){return this.getContainer()},setWidth:function(t){"number"==typeof t&&this._container.setAttribute("style","width: "+t+"px")}}),L.Control.gmxSidebar=L.Control.GmxSidebar,L.control.gmxSidebar=function(t){return new L.Control.GmxSidebar(t)},L.Control.GmxLoaderStatus=L.Control.extend({options:{id:"loaderStatus",position:"topleft",type:"gif"},_items:{},_text:"Loader status",addItem:function(t,o){var i=t||L.gmxUtil.newId(),e=this._items[i],n="gif"===this.options.type?"icon-refresh-gif":"animate-spin icon-refresh";return n+=o?" leaflet-gmx-loaderStatus-"+o:"",this._div.className=n,L.DomUtil.removeClass(this._container,"leaflet-gmx-visibility-hidden"),e?e++:this._items[i]=1,this._container.title=this._text+": "+Object.keys(this._items).length,i},removeItem:function(t){var o=this._items[t];o>1?this._items[t]--:delete this._items[t],0===Object.keys(this._items).length&&("gif"!==this.options.type&&L.DomUtil.removeClass(this._div,"animate-spin"),L.DomUtil.addClass(this._container,"leaflet-gmx-visibility-hidden")),this._container.title=this._text+": "+Object.keys(this._items).length},onRemove:function(t){t.gmxControlsManager&&t.gmxControlsManager.remove(this),t.fire("controlremove",this),delete L.gmx.loaderStatus},onAdd:function(t){var o=this.options,i="leaflet-gmx-visibility-hidden leaflet-gmx-"+o.id,e=L.DomUtil.create("div",i),n=L.DomUtil.create("div","gif"===o.type?"icon-refresh-gif":"animate-spin icon-refresh",e),s="Loader status";L.gmxLocale&&(s=L.gmxLocale.addText({eng:{hide:s},rus:{hide:"Статус загрузки"}}).getText("hide")),e._id=this.options.id,e.title=this._text=s,this._container=e,this._div=n,this._items={},t.fire("controladd",this),t.gmxControlsManager&&t.gmxControlsManager.add(this);var r=this;return L.gmxUtil||(L.gmxUtil={}),L.gmxUtil.loaderStatus=function(t,o,i){return r[o?"removeItem":"addItem"].apply(r,[t,i])},L.DomEvent.on(e,"click",L.DomEvent.stopPropagation).on(e,"click",function(){var t=Object.keys(this._items);console.info("Запросов в очереди на загрузку:",t.length,t)},this),e}}),L.Control.gmxLoaderStatus=L.Control.GmxLoaderStatus,L.control.gmxLoaderStatus=function(t){return new L.Control.GmxLoaderStatus(t)};