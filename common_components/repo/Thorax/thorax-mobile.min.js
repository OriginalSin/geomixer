(function(){function c(e){var t=e._constructorArg;e._referenceCount=0,e._objectOptionsByCid={},e._boundDataObjectsByCid={},_.each(w,function(t){e[t.name]=[]}),e.children={},e._renderCount=0,t&&_.extend(e,t),h(e),_.each(w,function(t){t.configure&&t.configure(e)}),e.trigger("configure")}function h(e){e.helpers&&_.each(e.helpers,function(t,n){e.helpers[n]=function(){var n=_.toArray(arguments),r=_.last(n);return r.context=this,t.apply(e,n)}})}function p(e){return'Error "'+e+'". For more information visit http://thoraxjs.org/error-codes.html'+"#"+e}function d(e,t){var n=new Error(p(e));return n.name=e,n.info=t,n}function v(e,t){var n=e.extend;e.extend=function(){var e=n.apply(this,arguments);return e.prototype.name&&(t[e.prototype.name]=e),e}}function m(e,t,n,r){var i=e[t],s;if(_.indexOf(n,".")>=0){var o=n.split(/\./);n=o.pop(),_.each(o,function(e){i=i[e]})}i&&(s=i[n]);if(!s&&!r)throw new Error(t+": "+n+" does not exist.");return s}function g(e,t,n){var r;_.isString(e[t])?r=l.Util.getViewClass(e[t],!0):e.name&&!_.isFunction(e[t])&&(r=l.Util.getViewClass(e.name+(n.extension||""),!0)),r&&!_.isFunction(e[t])&&(e[t]=r);if(n.required&&!_.isFunction(e[t]))throw new Error("View "+(e.name||e.cid)+" requires: "+t)}function y(e,t,n){var r;_.isString(e[t])?r=l.Util.getTemplate(e[t],!0):e.name&&!_.isFunction(e[t])&&(r=l.Util.getTemplate(e.name+(n.extension||""),!0)),!r&&t==="template"&&e._defaultTemplate&&(r=e._defaultTemplate),r&&!_.isFunction(e[t])&&(e[t]=r);if(n.required&&!_.isFunction(e[t])){var i=new Error("view-requires: "+t);throw i.info={name:e.name||e.cid,parent:e.parent&&(e.parent.name||e.parent.cid),helperName:e._helperName},i}}function b(e,t,n){return t=e&&e[t],t&&t.call?t.call(n||e):t}function E(e){_.each(w,function(t){e[t.name]||(e[t.name]=[])})}function S(e){_.each(w,function(t){e[t.name]=[]})}function x(e,t,n,r){var i=[];_.has(e,t)&&i.push(e);var s=e;if(n)while(s=s.__parent__)_.has(s,t)&&i.push(s);else{s=s.constructor;while(s&&s.__super__)s.prototype&&_.has(s.prototype,t)&&i.push(s.prototype),s=s.__super__&&s.__super__.constructor}var o=i.length;while(o--)_.each(b(i[o],t,e),r)}function T(e,t,n,r){if(_.isObject(n)){var i=w[t];if(i&&i.event)return e&&e.listenTo&&e[t]&&e[t].cid?C(e,n,r,t):C(e["_"+t+"Events"],n,r),!0}}function N(e,t,n,r,i){function u(){if(e.el)s.apply(i,arguments);else{if(o)throw new Error("destroyed-event:"+e.name+":"+n);o++}}var s=ut(r,e),o=0;u._callback=s._callback||s,u._thoraxBind=!0,e.listenTo(t,n,u)}function C(e,t,n,r){function i(t,i){r?N(e,e[r],i,t,n||e):e.push([i,t,n])}_.each(t,function(e,t){_.isArray(e)?_.each(e,function(e){i(e,t)}):i(e,t)})}function k(e){e.tag&&(e.tagName=e.tag,delete e.tag),e["class"]&&(e.className=e["class"],delete e["class"])}function A(e){if(!L){var t="area,base,br,col,embed,hr,img,input,keygen,link,menuitem,meta,param,source,track,wbr";L={},_.each(t.split(","),function(e){L[e]=!0})}return L[e]}function O(e,t){return function(){if($(this).parent().view({el:!0,helper:!0})[0]===e.el)return t.call(this)}}function M(e){function n(){if(e)i(function(){var n=t.shift();n?n():e()});else{var n;while(n=t.shift())n()}}var t=[];return{exec:function(r){t.push(function(){r(),e&&n()})},chain:function(r){t.push(function(){e?r(n):r()})},run:function(){e&&!t.length?i(e):n()}}}function H(e,t,n){function r(e){for(var t=0;e&&t<i.length;t++)i[t]!==""&&i[t]!=="."&&i[t]!=="this"&&(e=e[i[t]]);return e}var i=n.split(".");return r(t)||r(e)}function B(e,t,n){if(_.isString(e)||_.isNumber(e)||_.isNull(e)||_.isBoolean(e))return e;if(t!=null&&t!==!0&&!/^\.\.\//.test(t)){var r=Handlebars.Utils.appendContextPath(n.contextPath,t);if(H(n.view,n.root,r)===e)return{$lut:r}}throw d("server-marshall-object")}function R(e,t){return function(n){var r=$(n.target).view({el:!0,helper:!1});if(r[0]===t.el)return n.originalContext=this,e(n)}}function U(e,t,n){t+=n.event.originalName;var r=n.handler,i=typeof r=="string"?e[r]:r;if(!i)throw new Error('Event "'+r+'" does not exist '+(e.name||e.cid)+":"+t);var s=n.context||e,o=l.bindSection("thorax-event",{view:s.name||s.cid,eventName:t},function(){return i.apply(s,arguments)});return o._callback=i,o._thoraxBind=!0,o}function z(e){if(e.type)return e;var t=q[e];if(t)return t;t=z[e]={type:"view",name:e,originalName:e,nested:!1,selector:undefined};var n=e.match(F);return n&&I[n[2]]&&(t.type="DOM",t.name=n[2],t.nested=!!n[1],t.selector=n[3]),t}function W(e,t,n,r){return{event:z(e),context:r,handler:typeof n=="string"?t[n]:n}}function K(e){while(e._helperName&&e._helperName!=="view")e=e.parent;return e}function Q(e,t){if(t["expand-tokens"])return delete t["expand-tokens"],_.each(t,function(n,r){t[r]=l.Util.expandToken(n,e)}),!0}function G(e,t,n,r){return{inverse:n.inverse,options:n.hash,declaringView:r,parent:K(r),_helperName:e,_helperOptions:{options:nt(n),args:_.clone(t)}}}function Y(e,t,n){t.fn?e.template=t.fn:n&&n.prototype&&!n.prototype.template&&(e.template=Handlebars.VM.noop)}function Z(e,t,n){var r;if(n.factory){r=n.factory(e,t);if(!r)return;r._helperName=t._helperName,r._helperOptions=t._helperOptions}else r=new n(t);if(!r.el)throw d("insert-destroyed-factory");return r}function et(e,t,n,r){var i=r.declaringView,s=r._helperName;e.push(t),i._addChild(t),i.trigger.apply(i,["helper",s].concat(e)),n&&n.apply(this,e)}function tt(e,t,n){this._pendingAppend=undefined;var r=this;(e||this.$el).find("["+X+"]").forEach(function(e){var i=$(e),s=i.attr(X),o=r.children[s];o&&n.chain(function(e){V[s]?(o.render(V[s],e),delete V[s]):o.ensureRendered(e),i.replaceWith(o.el)}),o&&t&&n.exec(function(){t(o.$el)})})}function nt(e){var t=_.pick(e,"fn","inverse","hash","data");return t.data=_.omit(e.data,"cid","view","yield","root","_parent"),t.fn=t.fn||undefined,t.inverse=t.inverse||undefined,t}function rt(e,t){function n(e,t){return _.every(e,function(e,n){return t[n]===e})}return e._helperName!==t._helperName?!1:(e=e._helperOptions,t=t._helperOptions,e.args.length===t.args.length&&n(e.args,t.args)&&_.isEqual(_.keys(e.options).sort(),_.keys(t.options).sort())&&_.every(e.options,function(r,i){if(i==="data"||i==="hash")return n(e.options[i],t.options[i]);if(i==="fn"||i==="inverse"){if(t.options[i]===r)return!0;var s=t.options[i]||{};return r&&_.has(r,"program")&&!r.depth&&s.program===r.program}return t.options[i]===r}))}function it(e,t){function n(n,r){var i=this[e],s=b(this,t.$el);if(n===i)return this;i&&this.unbindDataObject(i);if(n){this[e]=n,t.loading&&t.loading(this),this.bindDataObject(e,n,_.extend({},this.options,r));if(s){var o={};$serverSide&&t.idAttrName&&(o[t.idAttrName]=n.id),o[t.cidAttrName]=n.cid,s.attr(o)}n.trigger("set",n,i)}else this[e]=!1,t.change&&t.change(this,!1),s&&s.removeAttr(t.cidAttrName);return this.trigger("change:data-object",e,n,i),this}t=w[e]=_.defaults({name:"_"+e+"Events",event:!0},t),t.ctor=function(n){if(n[e]){var r=n[e];n[e]=null,n[t.set](r)}},l.View.prototype[t.set]=n}function st(e,t,n,r){x(r,"_"+t+"Events",!0,function(t){N(e,n,t[0],t[1],t[2]||e)})}function ot(e,t){e.load?e.load(function(){t&&t.success&&t.success(e)},t):e.fetch(t)}function ut(e,t){return _.isFunction(e)?e:t[e]}function lt(e,t,n){if(n&&n.serializing)return;var r=e.getObjectOptions(t)||{};e.conditionalRender(r.render)}function yt(e,t){var n=e.getObjectOptions(t)||undefined;e.shouldRender(n&&n.render)&&e.renderCollection&&e.renderCollection()}function bt(e,t){var n=e.getObjectOptions(t)||undefined;e.shouldRender(n&&n.render)&&e.ensureRendered()}function wt(e,t){var n=e._collectionElement;e.itemFilter&&n.find("["+at+'="'+t.cid+'"]')[Et(e,t)?"show":"hide"]()}function Et(e,t){return e.itemFilter.call(e,t,e.collection.indexOf(t))}function St(e){var t=e._collectionElement;e.emptyClass&&t.removeClass(e.emptyClass),t.removeAttr(vt),t.empty()}function xt(e){var t=e._collectionElement;e.emptyClass&&t.addClass(e.emptyClass),t.attr(vt,!0),e.appendEmpty()}function Nt(e,t,n){n=n||{},n.target=e,e.trigger(t,n),_.each(e.children,function(e){e.trigger(t,n)})}function Ct(e){e.$el.attr(Tt,e.cid),e._layoutViewEl=e.el}function kt(e){var t=e.$("["+Tt+'="'+e.cid+'"]')[0];!t&&e.$el.attr(Tt)&&(t=e.el);if(!t)throw new Error("No layout element found in "+(e.name||e.cid));e._layoutViewEl=t}function Lt(e){return function(t,n){this.parent.trigger(e,t,n)}}function Ot(e,t){var n=K(e);if(!e[t]){var r=n[t];r&&(e[t]=r)}}function _t(e,t){return _.each(e,function(n,r){if(_.isObject(n))return _t(n,t);t(n,r,e)===!1&&delete e[r]}),e}function Dt(){Bt(this),this.model&&this.model.previousAttributes&&this.model.set(this.model.previousAttributes(),{silent:!0})}function Pt(e,t,n){var r=0;$("select,input,textarea",t.root||e.el).each(function(){var i=$(this);if(!t.children&&e.el!==i.view({el:!0,helper:!1})[0])return;var s=i.attr("type"),o=i.attr("name");s!=="button"&&s!=="cancel"&&s!=="submit"&&o&&(n(i,r,o,s),++r)})}function Ht(e,t,n,r){var i,s=e,o=t.split("["),u=n.mode;for(var a=0;a<o.length-1;++a){i=o[a].replace("]","");if(!s[i]){if(u!=="serialize")return r(undefined,i);s[i]={}}s=s[i]}i=o[o.length-1].replace("]",""),r(s,i)}function Bt(e){e.$("form").removeAttr("data-submit-wait"),e.$el.removeAttr("data-submit-wait")}function jt(e){var t=e.getObjectOptions(e.model)||{};return t.populate===!0?{}:t.populate}function Rt(e){var t=$(this),n=t.view({helper:!1}),r=t.attr(Ft),i=t.attr(It),s=!1;r&&(s=n[r](e)),i&&n.trigger(i,e),this.tagName==="A"&&s===!1&&e.preventDefault()}function zt(){Wt(),Ut=l._fastClickEventName||"click",$(document).on(Ut,qt,Rt)}function Wt(){Ut&&$(document).off(Ut,qt,Rt)}function Vt(e,t){this._pendingElement=undefined;var n=this;(e||this.$el).find("["+Xt+"]").forEach(function(e){var r=$(e),i=r.attr(Xt),s=n._elementsByCid[i];_.isFunction(s)&&(s=s.call(n)),r.replaceWith(s),t&&t($(s))})}function Yt(e,t){function s(){n||(r=Backbone.history.getFragment(),i=n=!0);if(i&&r===Backbone.history.getFragment()){i=!1;return}e=undefined,u.cancel(),t&&t()}function o(){Backbone.history.off("route",s),e&&e.apply(this,arguments)}var n=Backbone.History.started,r=n&&Backbone.history.getFragment(),i=Qt!==r;Backbone.history.on("route",s);var u=_.bind(o,this);return u.cancel=function(){Backbone.history.off("route",s)},u}function Zt(e,t,n,r){if(e.isPopulated())return _.defer(t,e);arguments.length===2&&!_.isFunction(n)&&_.isObject(n)&&(r=n,n=!1);var i=e,s=!1,o=Yt(_.bind(t,i),function(){s=!0,u&&u.aborted(),i._request&&(!i.fetchQueue||!i.fetchQueue.length)&&(i._aborted=!0,i._request.abort()),n&&n.call(i,!1)}),u;e.fetch(_.defaults({success:o,error:function(){o.cancel(),!s&&n&&n.apply(i,[!0].concat(_.toArray(arguments)))}},r)),u=_.last(e.fetchQueue)}function en(e,t,n){if(t.resetQueue)e.fetchQueue=undefined;else if(e.fetchQueue){var r=(e.fetchQueue[0].options||{}).reset;if(r!==t.reset)throw new Error(p("mixed-fetch"))}if(!e.fetchQueue){e.fetchQueue=[];var i=_.defaults({success:tn(e,e.fetchQueue,"success"),error:tn(e,e.fetchQueue,"error"),complete:tn(e,e.fetchQueue,"complete")},t);if(!n)return i;var s=n.call(e,i);if(!e.fetchQueue)return;e.fetchQueue._promise=s}var o;$.Deferred&&e.fetchQueue._promise&&e.fetchQueue._promise.then&&(o=$.Deferred(),e.fetchQueue._promise.then(_.bind(o.resolve,o),_.bind(o.reject,o)));var u=e.fetchQueue;return e.fetchQueue.push({aborted:function(){var n=_.indexOf(u,this);n>=0&&(u.splice(n,1),!u.length&&u===e.fetchQueue&&(e.fetchQueue=undefined));var r=[u._promise,"abort"];o&&o.rejectWith(t.context,r),t.error&&t.error.apply(t.context,r),t.complete&&t.complete.apply(t.context,r)},options:t}),o?o.promise():e.fetchQueue._promise}function tn(e,t,n){return function(){var r=arguments;_.each(t,function(e){var t=e.options;t[n]&&t[n].apply(this,r)},this),e.fetchQueue===t&&(e.fetchQueue=undefined)}}function rn(){this.render()}function ln(){}function cn(){_.each(this._domEvents||[],function(e){var t=e.split(" "),n=t.slice(1).join(" ")||undefined;t[0]==="click"&&$(n||this.el,n&&this.el).forEach(function(e){var t=$(e).attr("data-tappable",!0);an&&!fn[e.tagName]&&t.on("click",ln)})},this)}var e=window._idCounter||0,t="";window._resetIdCounter=function(n){e=0,t=n||""},_.uniqueId=function(n){var r=t+ ++e;return n?n+r:r},window.$serverSide&&FruitLoops.onEmit(function(){$("body").append("<script>window._idCounter = "+e+";</script>")}),typeof $serverSide=="undefined"&&(window.$serverSide=!1);var n=!!navigator.userAgent.match(/Trident\/7\./),r=n||/msie [\w.]+/.exec(navigator.userAgent.toLowerCase());$.fn.forEach||($.fn.forEach=function(e,t){$.fn.each.call(this,function(n){e.call(t||this,this,n)})});var i=window.setImmediate||function(e){setTimeout(e,0)},s="data-view-name",o="data-view-cid",u="data-view-helper",a="data-view-restore",f={};Handlebars.templates||(Handlebars.templates={});var l=this.Thorax={templatePathPrefix:"",Views:{},bindSection:function(e,t,n){return n||(n=t,t=undefined),l.onException?function(){try{return n.apply(this,arguments)}catch(r){l.onException(e,r,t)}}:n},runSection:function(e,t,n){return l.bindSection(e,t,n)()},onException:null,templates:Handlebars.templates};l.View=Backbone.View.extend({constructor:function(t){this._constructorArg=t;var n=Backbone.View.call(this,t);return this._constructorArg=undefined,_.each(w,function(e){e.ctor&&e.ctor(this,n)},this),n},toString:function(){return"[object View."+this.name+"]"},_configure:function(){},_ensureElement:function(){c(this);if(!$serverSide&&this.el){var e=$(_.result(this,"el"));if(e.length&&e.attr("data-view-restore")==="true")return this.restore(e)}return Backbone.View.prototype._ensureElement.call(this)},setElement:function(e,t){var n=$(e),r=n.attr("data-view-cid");r&&this._assignCid(r);var i=Backbone.View.prototype.setElement.call(this,n,t),o={"data-view-cid":this.cid};return this.name&&(o[s]=this.name),this.$el.attr(o),e.parentNode&&this.retain(),i},_assignCid:function(e){this.cid&&f[this.cid]&&(delete f[this.cid],f[e]=this),this.parent&&(delete this.parent.children[this.cid],this.parent.children[e]=this),this.cid=e},_addChild:function(e){return this.children[e.cid]?e:(e.retain(),this.children[e.cid]=e,e.parent&&e.parent!==this&&!e._helperOptions&&e.parent._removeChild(e),e.parent=this,this.trigger("child",e),e)},_removeChild:function(e){return delete this.children[e.cid],e.parent=null,e.release(),e},_destroy:function(){this.trigger("destroyed"),delete f[this.cid],this.stopListening(),this.off(),_.each(this.children,function(e){e.parent=null,e.release()}),this.el&&(this.undelegateEvents(),this.$el.remove(),P.destroy(this.$el)),this.el=this.$el=this.parent=this.children=this.model=this.collection=this._collection=this._boundDataObjectsByCid=this._objectOptionsByCid=this._helperOptions=undefined},restore:function(e,t){e=e[0]||e;if(this._renderCount){var n=this.$el.attr("data-view-cid");this.cid!==n&&this._assignCid(n),$(e).replaceWith(this.$el),this.trigger("restore:fail",{type:"previously-rendered",view:this,element:e});return}this.setElement(e);var r=this.$el.attr("data-view-restore")==="true";this.$el.removeAttr("data-view-restore");if(!$serverSide&&r){y(this,"template",{required:!1}),this._renderCount=1,this.trigger("restore",t);if(t)this.render();else{var i=this.$("[data-view-restore]"),s=_.filter(i,function(t){var n=$(t).parent();return!n.attr("data-layout-cid")&&n.view({el:!0,helper:!0})[0]===e});s.length&&(this.trigger("restore:fail",{type:"remaining",view:this,element:e,rerendered:s}),this.render())}return this.trigger("after-restore",t),!0}this.trigger("restore:fail",{type:"not-restorable",view:this,element:e}),this.render()},render:function(e,t){var n=this;return n.el?(l.runSection("thorax-render",{name:n.name},function(){if(n._rendering)throw d("nested-render");n._rendering=!0;var i=new M(t),s={},o=[];_.each(n.children,function(e,t){e._helperOptions?(e._cull=!0,o.push(e)):s[t]=e}),n.children=s,n._previousHelpers=o,n.trigger("before:rendered",i),i.exec(function(){_.isUndefined(e)||!_.isElement(e)&&!l.Util.is$(e)&&(!e||!e.el)&&!_.isString(e)&&!_.isFunction(e)?(y(n,"template",{required:!0}),e=n.renderTemplate(n.template)):_.isFunction(e)&&(e=n.renderTemplate(e))}),i.exec(function(){_.each(o,function(e){e._cull&&n._removeChild(e)}),n._previousHelpers=undefined,$serverSide?n.$el.attr(a)!=="false"&&n.$el.attr(a,$serverSide):n.$el.removeAttr(a)}),i.chain(function(t){n.html(e&&e.el||e&&e.string||e,t)}),i.exec(function(){++n._renderCount,n.trigger("rendered"),n._rendering=!1}),i.run()}),n):n},context:function(){return this.model&&this.model.attributes},_getContext:function(){var e=Object.create?Object.create(this):_.clone(this);return _.extend(e,this.context.call?this.context():this.context)},_getData:function(e){return{view:this,root:e,cid:_.uniqueId("t"),yield:function(){return e.fn&&e.fn(e)}}},renderTemplate:function(e,t,n){var r;return _.isFunction(e)?r=e:r=l.Util.getTemplate(e,n),!r||r===Handlebars.VM.noop?"":(t=t||this._getContext(),r(t,{helpers:this.helpers,data:this._getData(t)}))},ensureRendered:function(e){this._renderCount?e&&i(e):this.render(undefined,e)},shouldRender:function(e){return e||e==null&&this._renderCount},conditionalRender:function(e){this.shouldRender(e)&&this.render()},appendTo:function(e){this.ensureRendered(),$(e).append(this.el),this.trigger("ready",{target:this})},html:function(e,t){if(_.isUndefined(e))return this.$el.html();this.trigger("before:append");var n=this._replaceHTML(e);return this.triggerDeferrable("append",undefined,undefined,t),n},release:function(){--this._referenceCount,this._referenceCount<=0&&this._destroy()},retain:function(e){f[this.cid]||(f[this.cid]=this),++this._referenceCount,e&&this.listenTo(e,"destroyed",e.release)},_replaceHTML:function(e){if(this._renderCount&&(r||$.fn.jquery))while(this.el.hasChildNodes())this.el.removeChild(this.el.childNodes[0]);return this.$el.empty(),this.$el.append(e)},_anchorClick:function(e){var t=$(e.currentTarget),n=t.attr("href");return e.metaKey||e.shiftKey?!0:n&&(n[0]==="#"||n[0]==="/"&&n[1]!=="/")?(Backbone.history.navigate(n,{trigger:!0}),!1):!0}}),l.View.extend=function(){E(this);var e=Backbone.View.extend.apply(this,arguments);return e.__parent__=this,S(e),e},v(l.View,l.Views),$.fn.view=function(e){e=_.defaults(e||{},{helper:!0});var t="["+o+"]";e.helper||(t+=":not(["+u+"])");var n=$(this).closest(t);if(n){if(e.el)return n;var r=n.attr(o),i=f[r];if(!i)throw d("fn-view-unregistered");return i}return!1};var w={},L;l.Util={getViewInstance:function(e,t){var n=l.Util.getViewClass(e,!0);return n?new n(t||{}):e},getViewClass:function(e,t){return _.isString(e)?m(l,"Views",e,t):_.isFunction(e)?e:!1},getTemplate:function(e,t){if(_.isFunction(e))return e;var n=l.templatePathPrefix,r;n&&e.substr(0,n.length)!==n&&(e=n+e),e=e.replace(/\.handlebars$/,""),r=Handlebars.templates[e],r||(e+=".handlebars",r=Handlebars.templates[e]);if(!r&&!t)throw new Error("templates: "+e+" does not exist.");return r},is$:function(e){return _.isObject(e)&&"length"in e},expandToken:function(e,t,n){if(e&&e.indexOf&&e.indexOf("{{")>=0){var r=/(?:\{?[^{]+)|(?:\{\{([^}]+)\}\})/g,i,s=[];function o(e,t){if(e.match(/^("|')/)&&e.match(/("|')$/))return e.replace(/(^("|')|('|")$)/g,"");var r=e.split("."),i=r.length;for(var s=0;t&&s<i;s++)r[s]!=="this"&&(t=t[r[s]]);return n&&_.isString(t)?encodeURIComponent(t):t}while(i=r.exec(e))if(i[1]){var u=i[1].split(/\s+/);if(u.length>1){var a=u.shift();u=_.map(u,function(e){return o(e,t)}),Handlebars.helpers[a]?s.push(Handlebars.helpers[a].apply(t,u)):s.push(i[0])}else s.push(o(u[0],t))}else s.push(i[0]);e=s.join("")}return e},tag:function(e,t,n){var r=e.tagName||"div",i=A(r);if(i&&t)throw new Error(p("void-tag-content"));var s="<"+r+" "+_.map(e,function(e,t){if(e==null||t==="expand-tokens"||t==="tagName")return"";var r=e;return n&&(r=l.Util.expandToken(e,n)),(t==="className"?"class":t)+'="'+Handlebars.Utils.escapeExpression(r)+'"'}).join(" ")+">";return i?s:s+(t==null?"":t)+"</"+r+">"}},l.Util.Deferrable=M,l.View.prototype.triggerDeferrable=function(){var e=[],t=arguments.length-1,n=arguments[t];for(var r=0;r<t;r++)e.push(arguments[r]);var i=new M(n);e.push(i),this.trigger.apply(this,e),i.run()};var D=window._thoraxServerData||[],P=l.ServerMarshal={store:function(e,t,n,r,i){if(!$serverSide)return;r=r||{},i=i&&i.data||i||{};var s=e._serverData||parseInt(e.attr("data-server-data"),10);isNaN(s)&&(s=D.length,D[s]={},e._serverData=s,e.attr("data-server-data",s));var o=D[s];o[t]=undefined;if(_.isArray(n)&&!_.isString(r)&&!n.toJSON)n.length&&(o[t]=_.map(n,function(e,t){return B(e,r[t],i)}));else if(_.isObject(n)&&!_.isString(r)&&!n.toJSON){var u={},a;_.each(n,function(e,t){u[t]=B(e,r[t],i),a=!0}),a&&(o[t]=u)}else o[t]=B(n,r,i)},load:function(e,t,n,r){function o(e){return e&&e.$lut!=null?H(n,r,e.$lut):e}var i=parseInt(e.getAttribute("data-server-data"),0),s=D[i];if(!s)return;s=s[t];if(_.isArray(s))return _.map(s,o);if(!_.isFunction(s)&&_.isObject(s)&&s.$lut==null){var u={};return _.each(s,function(e,t){u[t]=o(e)}),u}return o(s)},serialize:function(){if($serverSide)return JSON.stringify(D)},destroy:function(e){var t=parseInt(e.attr("data-server-data"),10);if(!isNaN(t)){D[t]=undefined;var n=D.length;while(n--&&!D[n]);n<D.length-1&&(D.length=n+1)}},_reset:function(){D=[]}};$serverSide&&FruitLoops.onEmit(function(){$("body").append("<script>var _thoraxServerData = "+P.serialize()+";</script>")}),l.Mixins={},_.extend(l.View,{mixin:function(e){l.Mixins[e](this)},registerMixin:function(e,t,n){l.Mixins[e]=function(e){var r=!!e.cid;n&&_.extend(r?e:e.prototype,n),r?t.call(e):e.on("configure",t)}}}),l.View.prototype.mixin=function(e){l.Mixins[e](this)};var j=l.View.prototype.on,F=/^(nested\s+)?(\S+)(?:\s+(.+))?/,I={},q={};(function(e){_.each(e,function(e){I[e]=!0})})(["touchstart","touchmove","touchend","touchcancel","mouseenter","mouseleave","mousemove","mousedown","mouseup","mouseover","mouseout","keydown","keyup","keypress","contextmenu","click","dblclick","focusin","focusout","focus","blur","submit","input","change","dragstart","drag","dragenter","dragleave","dragover","drop","dragend","singleTap","doubleTap","longTap","swipe","swipeUp","swipeDown","swipeLeft","swipeRight"]),w.event={name:"_events",configure:function(e){x(e.constructor,"_events",!0,function(t){e.on.call(e,t[0],t[1])}),x(e,"events",!1,function(t,n){e.on(n,t,e)})}},_.extend(l.View,{on:function(e,t){return E(this),T(this,e,t)?this:(_.isObject(e)?_.each(e,function(e,t){this.on(t,e)},this):(e=z(e),_.isArray(t)?_.each(t,function(t){this._events.push([e,t])},this):this._events.push([e,t])),this)}}),_.extend(l.View.prototype,{on:function(e,t,n){var r=this;if(T(r,e,t,n))return r;if(_.isObject(e)&&!e.type&&arguments.length<3)_.each(e,function(e,n){r.on(n,e,t||r)});else{function i(t){var i=W(e,r,t,n||r);if(i.event.type==="DOM"){if($serverSide)return;r._eventsToDelegate||(r._eventsToDelegate=[]),r._eventsToDelegate.push(i)}(i.event.type!=="DOM"||r._eventsDelegated)&&r._addEvent(i)}_.isArray(t)?_.each(t,i):i(t)}return r},delegateEvents:function(e){this.undelegateEvents(),e&&(_.isFunction(e)&&(e=e.call(this)),this._eventsToDelegate=[],this.on(e)),_.each(this._eventsToDelegate,this._addEvent,this),this._eventsDelegated=!0},_addEvent:function(e){if(e.handler._thoraxBind)return j.call(this,e.event.name,e.handler,e.context||this);if($serverSide&&e.event.type!=="view")return;var t=U(this,e.event.type+"-event:",e);if(e.event.type==="view")e.context&&e.context!==this&&e.context instanceof l.View?N(e.context,this,e.event.name,t,e.context):j.call(this,e.event.name,t,e.context||this);else{e.event.nested||(t=R(t,this));var n=e.event.name+".delegateEvents"+this.cid;e.event.selector?this.$el.on(n,e.event.selector,t):this.$el.on(n,t)}}}),l.View.prototype.bind=l.View.prototype.on,l.View.on("ready",function(e){if(!this._isReady){this._isReady=!0;function t(t){t._isReady||t.trigger("ready",e)}_.each(this.children,t),this.on("child",t)}});var X="data-view-tmp",V={},J={_ensureElement:function(){l.View.prototype._ensureElement.call(this),this.$el.attr(u,this._helperName)},_getContext:function(){return this.parent._getContext()}};l.HelperView=l.View.extend(J),Handlebars.registerViewHelper=function(e,t,n){function s(e,t,n){try{P.store(e.$el,"args",t,n.ids,n),P.store(e.$el,"attrs",n.hash,n.hashIds,n);if(n.fn&&n.fn!==Handlebars.VM.noop){if(n.fn.depth)throw new Error;P.store(e.$el,"fn",n.fn.program)}if(n.inverse&&n.inverse!==Handlebars.VM.noop){if(n.inverse.depth)throw new Error;P.store(e.$el,"inverse",n.inverse.program)}}catch(r){e.$el.attr("data-view-restore","false"),e.trigger("restore:fail",{type:"serialize",view:e,err:r})}}arguments.length===2&&(t.factory?n=t.callback:(n=t,t=l.HelperView));var r=t.attributeWhiteList;Handlebars.registerHelper(e,function(){var i=[],o=arguments[arguments.length-1],u=o.data.view;for(var a=0,f=arguments.length-1;a<f;a++)i.push(arguments[a]);var c=Q(this,o.hash),h=G(e,i,o,u);Y(h,o,t),k(o.hash);var p=_.clone(o.hash);_.each(r,function(e,t){delete p[t],_.isUndefined(o.hash[t])||(h[e]=o.hash[t])}),p.tagName&&(h.tagName=p.tagName),h.attributes=function(){var e=t.prototype&&t.prototype.attributes||{};return _.isFunction(e)&&(e=e.call(this)),_.extend(e,_.omit(p,["tagName"])),e.className&&(e["class"]=e.className,delete e.className),e};var d=_.find(u._previousHelpers,function(e){return e._cull&&rt(h,e)});if(!d){d=Z(i,h,t);if(!d)return"";d.$el.attr("data-view-helper-restore",e),$serverSide&&d.$el.attr("data-view-restore")!=="false"&&s(d,i,o),et(i,d,n,h)}else{if(!d.el)throw new Error("insert-destroyed");u.children[d.cid]=d}return d._cull=!1,u._pendingAppend||(u._pendingAppend=!0,u.once("append",tt)),p[X]=d.cid,t.modifyHTMLAttributes&&t.modifyHTMLAttributes(p,d),new Handlebars.SafeString(l.Util.tag(p,"",c?this:null))});var i=Handlebars.helpers[e];return i.restore=function(i,s,o){var u=i.context(),a=P.load(s,"args",i,u)||[],f=P.load(s,"attrs",i,u)||{},l={hash:f,fn:P.load(s,"fn"),inverse:P.load(s,"inverse")};i.template._setup({helpers:this.helpers}),l.fn&&(l.fn=i.template._child(l.fn)),l.inverse&&(l.inverse=i.template._child(l.inverse));var c=G(e,a,l,i);Y(c,l,t),r&&_.each(r,function(e,t){_.isUndefined(f[t])||(c[e]=f[t])});var h=Z(a,c,t);if(!h)return;return h._assignCid(s.getAttribute("data-view-cid")),et(a,h,n,c),h.restore(s,o),h},i},l.View.on("restore",function(e){var t=this,n;t.$("[data-view-helper-restore][data-view-restore=true]").each(O(t,function(){var n=Handlebars.helpers[this.getAttribute("data-view-helper-restore")],r=n.restore(t,this,e);r&&t._addChild(r)}))}),_.extend(l.View.prototype,{getObjectOptions:function(e){return e&&this._objectOptionsByCid[e.cid]},bindDataObject:function(e,t,n){if(this._boundDataObjectsByCid[t.cid])return;this._boundDataObjectsByCid[t.cid]=t;var n=this._modifyDataObjectOptions(t,_.extend({},w[e].defaultOptions,n));this._objectOptionsByCid[t.cid]=n,st(this,e,t,this.constructor),st(this,e,t,this);var r=w[e];r.bindCallback&&r.bindCallback(this,t,n),t.shouldFetch&&t.shouldFetch(n)?ot(t,n):w[e].change&&w[e].change(this,t,n)},unbindDataObject:function(e){this.stopListening(e),delete this._boundDataObjectsByCid[e.cid],delete this._objectOptionsByCid[e.cid]},_modifyDataObjectOptions:function(e,t){return t}});var at="data-model-cid",ft="data-model-id";l.Model=Backbone.Model.extend({isEmpty:function(){return!this.isPopulated()},isPopulated:function(){var e=_.clone(this.attributes),t=b(this,"defaults")||{};for(var n in t){if(e[n]!=t[n])return!0;delete e[n]}var r=_.keys(e);return r.length>1||r.length===1&&r[0]!==this.idAttribute},shouldFetch:function(e){var t;try{t=b(this,"url")}catch(n){t=!1}return e.fetch&&!!t&&!this.isPopulated()}}),l.Models={},v(l.Model,l.Models),it("model",{set:"setModel",defaultOptions:{render:undefined,fetch:!0,success:!1,invalid:!0},change:lt,$el:"$el",idAttrName:ft,cidAttrName:at}),l.View.on({model:{invalid:function(e,t){this.getObjectOptions(e).invalid&&this.trigger("invalid",t,e)},error:function(e,t){this.trigger("error",t,e)},change:function(e,t){w.model.change(this,e,t)}}}),$.fn.model=function(e){var t=$(this),n=t.closest("["+at+"]"),r=n&&n.attr(at);if(r){var e=e||t.view();if(e&&e.model&&e.model.cid===r)return e.model||!1;var i=t.collection(e);if(i)return i.get(r)}return!1};var ct=Backbone.Collection.prototype.fetch,ht=Backbone.Collection.prototype.set,pt=l.View.prototype._replaceHTML,dt="data-collection-cid",vt="data-collection-empty",mt="data-collection-element",gt=1;l.Collection=Backbone.Collection.extend({model:l.Model||Backbone.Model,initialize:function(e,t){return this.cid=_.uniqueId("collection"),Backbone.Collection.prototype.initialize.call(this,e,t)},isEmpty:function(){return this.length>0?!1:this.length===0&&this.isPopulated()},isPopulated:function(){return this._fetched||this.length>0||!this.length&&!b(this,"url")},shouldFetch:function(e){return e.fetch&&!!b(this,"url")&&!this.isPopulated()},fetch:function(e){e=e||{};var t=e.success;return e.success=function(e,n,r){e._fetched=!0,t&&t(e,n,r)},ct.call(this,e)},set:function(e,t){return this._fetched=!!e,ht.call(this,e,t)}}),_.extend(l.View.prototype,{getCollectionViews:function(e){return _.filter(this.children,function(t){return t instanceof l.CollectionView?!e||t.collection===e:!1})},updateFilter:function(e){_.invoke(this.getCollectionViews(e),"updateFilter")}}),l.Collections={},v(l.Collection,l.Collections),it("collection",{set:"setCollection",bindCallback:bt,defaultOptions:{render:undefined,fetch:!0,success:!1,invalid:!0,change:!0},change:yt,$el:"getCollectionElement",cidAttrName:dt}),l.CollectionView=l.View.extend({_defaultTemplate:Handlebars.VM.noop,_collectionSelector:"["+mt+"]",_replaceHTML:function(e){if(!(this.collection&&this.getObjectOptions(this.collection)&&this._renderCount)){var r=pt.call(this,e);return this._lookupCollectionElement(),r}var t,n=this._collectionElement;t=pt.call(this,e),this._lookupCollectionElement(),n.attr("data-view-cid")||this._collectionElement.replaceWith(n)},render:function(e,t){if(!this.shouldRender()){var n=this;this.once("append",function(e,t,r){r.chain(function(e){n.renderCollection(e)})})}return l.View.prototype.render.call(this,e,t)},restore:function(e,t){this._forceRerender=t,l.View.prototype.restore.call(this,e)},restoreCollection:function(){var e=this,t=this.$el.children(),n=[],r=0;this._lookupCollectionElement(),this.$("["+ft+"]").each(O(e,function(){var i=this.getAttribute(ft),s=e.collection.get(i);s?(e.restoreItem(s,t.index(this),this,e._forceRerender),r++):n.push(this)}));var i;this.$("[data-view-empty]").each(O(e,function(){e.collection.length?i=!0:e.restoreEmpty(this,e._forceRerender)}));var s=r!==this.collection.length||n.length||i;if(s&&this.collection.isPopulated()){_.each(n,function(t){t.parentNode.removeChild(t),e.trigger("restore:fail",{type:"collection-remove",element:t})});if(i||!this.collection.length)this.renderCollection(),e.trigger("restore:fail",{type:i?"collection-empty-found":"collection-empty-missing"});else{var o=this._collectionElement;this.collection.each(function(t){o.find("["+at+'="'+t.cid+'"]').length||(e.appendItem(t),e.trigger("restore:fail",{type:"collection-missing",model:t}))})}}else if(s){this._pendingRestore=!0;return}this.trigger("restore:collection",this,this.el)},appendItem:function(e,t,n,r,i){if(!e)return;var s,o=this._collectionElement,u=this.collection,a=!n||n.filter==null||n.filter;t&&t.el&&(t=o.children().indexOf(t.el)+1),e.el||_.isString(e)?(s=e,e=!1):(t=t!=null?t:u.indexOf(e)||0,s=this.renderItem.call(this,e,t));if(s){s.cid&&(this._addChild(s),s.ensureRendered()),_.isString(s)&&!/^\s*</m.test(s)&&(s="<div>"+s+"</div>");var f=s.$el||$($.trim(s)).filter(function(){return this.nodeType===gt||this.type==="tag"});e&&f.attr({"data-model-id":e.id,"data-model-cid":e.cid});if(r)o.append(f);else{var l=t>0?u.at(t-1):!1;if(!l)o.prepend(f);else{var c=o.children("["+at+'="'+l.cid+'"]').last();c.after(f)}}this.triggerDeferrable("append",null,function(t){t.attr({"data-model-cid":e.cid,"data-model-id":e.id})},i),(!n||!n.silent)&&this.trigger("rendered:item",this,u,e,f,t),a&&wt(this,e)}return s},updateItem:function(e){var t=this._collectionElement,n=t.find("["+at+'="'+e.cid+'"]');if(n.attr(o))return;this.removeItem(n),this.appendItem(e)},removeItem:function(e){function i(e){var n=e.attr(o),r=t.children[n];r&&t._removeChild(r)}var t=this,n=e;if(e.cid){var r=this._collectionElement;n=r.find("["+at+'="'+e.cid+'"]')}return n.length?(n.find("["+o+"]").each(function(e,t){i($(t))}),i(n),n.detach(),!0):!1},renderCollection:function(e){var t=new M(e),n=this;n.collection?(n.collection.isEmpty()?t.exec(function(){xt(n)}):n._pendingRestore?(n._pendingRestore=!1,n.restoreCollection(n._forceRerender)):(t.exec(function(){St(n)}),_.each(n.collection.models,function(e,r){t.chain(function(t){n.appendItem(e,r,undefined,!0,t)})})),t.exec(function(){n.trigger("rendered:collection",n,n.collection)})):t.exec(function(){xt(n)}),t.run()},emptyClass:"empty",renderEmpty:function(){this.emptyView||g(this,"emptyView",{extension:"-empty"}),!this.emptyTemplate&&!this.emptyView&&y(this,"emptyTemplate",{extension:"-empty",required:!1});if(this.emptyView){var e={};return this.emptyTemplate&&(e.template=this.emptyTemplate),l.Util.getViewInstance(this.emptyView,e)}return this.emptyTemplate&&this.renderTemplate(this.emptyTemplate)},restoreEmpty:function(e,t){var n=this.renderEmpty();return n.restore(e,t),this._addChild(n),this.trigger("restore:empty",this,e),n},renderItem:function(e,t){this.itemView||g(this,"itemView",{extension:"-item",required:!1}),!this.itemTemplate&&!this.itemView&&y(this,"itemTemplate",{extension:"-item",required:!this.itemView});if(this.itemView){var n={model:e};return this.itemTemplate&&(n.template=this.itemTemplate),l.Util.getViewInstance(this.itemView,n)}return this.renderTemplate(this.itemTemplate,this.itemContext.call(this,e,t))},restoreItem:function(e,t,n,r){n.setAttribute(at,e.cid);if(this.itemView||this.renderItem!==l.CollectionView.prototype.renderItem){var i=this.renderItem(e,t);_.isString(i)||(i.restore(n,r),this._addChild(i))}this.trigger("restore:item",this,n)},itemContext:function(e){return e.attributes},appendEmpty:function(){var e=this._collectionElement;e.empty();var t=this.renderEmpty.call(this);t&&t.$el&&t.$el.attr("data-view-empty","true"),t&&this.appendItem(t,0,{silent:!0,filter:!1}),this.trigger("rendered:empty",this,this.collection)},getCollectionElement:function(){return this._collectionElement},_lookupCollectionElement:function(){var e=this.$(this._collectionSelector).filter(O(this,function(){return!0}));this._collectionElement=e.length?e:this.$el},updateFilter:function(){var e=this;e.itemFilter&&_.each(e.collection.models,function(t){wt(e,t)})}}),l.CollectionView.on({restore:"restoreCollection",collection:{reset:function(e){yt(this,e)},sort:function(e){yt(this,e)},change:function(e){var t=this.getObjectOptions(this.collection);t&&t.change&&this.updateItem(e),wt(this,e)},add:function(e){var t=this._collectionElement;if(t.length){this.collection.length===1&&St(this);var n=this.collection.indexOf(e);this.appendItem(e,n)}},remove:function(e){var t=this._collectionElement;this.removeItem(e),this.collection.length===0&&t.length&&xt(this)}}}),l.View.on({collection:{invalid:function(e,t){this.getObjectOptions(e).invalid&&this.trigger("invalid",t,e)},error:function(e,t){this.trigger("error",t,e)}}}),$.fn.collection=function(e){if(e&&e.collection)return e.collection;var t=$(this),n=t.closest("["+dt+"]"),r=n&&n.attr(dt);if(r){e=t.view();if(e)return e.collection}return!1};var Tt="data-layout-cid";l.LayoutView=l.View.extend({_defaultTemplate:Handlebars.VM.noop,render:function(e){var t=l.View.prototype.render.call(this,e);return this.template===Handlebars.VM.noop?Ct(this):kt(this),t},restore:function(e,t){this._forceRerender=t,l.View.prototype.restore.call(this,e)},setView:function(e,t){function f(){r&&(r.$el&&r.$el.detach(),Nt(r,"deactivated",t),o._removeChild(r))}function c(){if(!e)o._view=undefined;else if($serverSide&&!u)o._view=e,o._addChild(e),FruitLoops.emit();else{e.ensureRendered(),t.activating=e,Nt(o,"activated",t),e.trigger("activated",t),o._view=e;var n=o._layoutViewEl;o._view.appendTo(n),o._addChild(e)}}function h(){o.hasBeenSet=!0,o.trigger("change:view:end",e,r,t)}t=_.extend({scroll:!0},t),_.isString(e)&&(e=new(l.Util.registryGet(l,"Views",e,!1)));if(!$serverSide&&!this.hasBeenSet){var n=this.$("["+s+'="'+e.name+'"]')[0];n?e.restore(n,this._forceRerender):$(this._layoutViewEl).empty()}this.ensureRendered();var r=this._view,o=this,u=e&&$serverSide&&(t.serverRender||e.serverRender),a=t.async!==!1?t.async||u:!1;if(e===r)return!1;if(a&&e&&!e._renderCount){i(function(){e.ensureRendered(function(){o.setView(e,t)})});return}return this.trigger("change:view:start",e,r,t),t.transition?t.transition(e,r,c,f,h):(f(),c(),h()),e},getView:function(){return this._view}}),l.LayoutView.on("after-restore",function(){kt(this)}),Handlebars.registerHelper("layout-element",function(e){var t=e.data.view;if(!t.getView)throw new Error(p("layout-element-helper"));return e.hash[Tt]=t.cid,k(e.hash),new Handlebars.SafeString(l.Util.tag.call(this,e.hash,"",this))}),l.CollectionHelperView=l.CollectionView.extend({events:{"rendered:collection":Lt("rendered:collection"),"rendered:item":function(e,t,n,r,i){this.parent.trigger("rendered:item",e,t,n,r,i)},"rendered:empty":Lt("rendered:empty"),"restore:collection":Lt("restore:collection"),"restore:item":Lt("restore:item"),"restore:empty":Lt("restore:empty")},getCollectionElement:function(){return this.$el},constructor:function(e){var t=!0;e.options["item-template"]&&(e.itemTemplate=l.Util.getTemplate(e.options["item-template"])),e.options["empty-template"]&&(e.emptyTemplate=l.Util.getTemplate(e.options["empty-template"])),!e.itemTemplate&&e.template&&e.template!==Handlebars.VM.noop&&(e.itemTemplate=e.template,e.template=Handlebars.VM.noop,e.itemTemplate.depth&&(t=!1)),!e.emptyTemplate&&e.inverse&&e.inverse!==Handlebars.VM.noop&&(e.emptyTemplate=e.inverse,e.inverse=Handlebars.VM.noop,e.emptyTemplate.depth&&(t=!1));var n=_.isFunction(e.itemContext),r=_.isFunction(e.itemFilter),i=l.HelperView.call(this,e);return n?this.itemContext=_.bind(this.itemContext,this.parent):_.isString(this.itemContext)&&(this.itemContext=_.bind(this.parent[this.itemContext],this.parent)),r?this.itemFilter=_.bind(this.itemFilter,this.parent):_.isString(this.itemFilter)&&(this.itemFilter=_.bind(this.parent[this.itemFilter],this.parent)),this.parent.name&&(!this.emptyView&&!this.parent.renderEmpty&&(this.emptyView=l.Util.getViewClass(this.parent.name+"-empty",!0)),!this.emptyTemplate&&!this.parent.renderEmpty&&(this.emptyTemplate=l.Util.getTemplate(this.parent.name+"-empty",!0)),!this.itemView&&!this.parent.renderItem&&(this.itemView=l.Util.getViewClass(this.parent.name+"-item",!0)),!this.itemTemplate&&!this.parent.renderItem&&(this.itemTemplate=l.Util.getTemplate(this.parent.name+"-item",!!this.itemView))),$serverSide&&!t&&(this.$el.attr(a,"false"),this.trigger("restore:fail",{type:"serialize",view:this,err:"collection-depthed-query"})),i},setAsPrimaryCollectionHelper:function(){var e=this,t=e.parent;_.each(At,function(t){Ot(e,t)}),_.each(["itemFilter","itemContext","renderItem","renderEmpty"],function(n){t[n]&&(e[n]=function(e,r){return t[n](e,r)})})}}),_.extend(l.CollectionHelperView.prototype,J),l.CollectionHelperView.attributeWhiteList={"item-context":"itemContext","item-filter":"itemFilter","item-template":"itemTemplate","empty-template":"emptyTemplate","item-view":"itemView","empty-view":"emptyView","empty-class":"emptyClass"};var At=["itemTemplate","itemView","emptyTemplate","emptyView"];Handlebars.registerViewHelper("collection",l.CollectionHelperView,function(e,t){arguments.length===1&&(t=e,e=t.parent.collection,e&&t.setAsPrimaryCollectionHelper(),t.$el.attr(mt,"true"),t.listenTo(t.parent,"change:data-object",function(e,n){e==="collection"&&(t.setAsPrimaryCollectionHelper(),t.setCollection(n))})),e&&t.setCollection(e)}),Handlebars.registerHelper("collection-element",function(e){if(!e.data.view.renderCollection)throw new Error(p("collection-element-helper"));var t=e.hash;return k(t),t.tagName=t.tagName||"div",t[mt]=!0,new Handlebars.SafeString(l.Util.tag.call(this,t,"",this))}),Handlebars.registerHelper("empty",function(e,t){arguments.length===1&&(t=e);var n=t.data.view;return arguments.length===1&&(e=n.model),n._emptyListeners||(n._emptyListeners={}),e&&!n._emptyListeners[e.cid]&&e.models&&"length"in e&&(n._emptyListeners[e.cid]=!0,n.listenTo(e,"remove",function(){e.length===0&&n.render()}),n.listenTo(e,"add",function(){e.length===1&&n.render()}),n.listenTo(e,"reset",function(){n.render()})),!e||e.isEmpty()?t.fn(this):t.inverse(this)}),Handlebars.registerHelper("template",function(e,t){var n=!1;for(var r in t.hash){n=!0;break}var i=this;if(t.fn||n)i=Object.create?Object.create(this):_.clone(this),_.extend(i,{fn:t.fn},t.hash);var s=t.data.view.renderTemplate(e,i);return new Handlebars.SafeString(s)}),Handlebars.registerHelper("yield",function(e){return e.data.yield()}),Handlebars.registerHelper("url",function(e,t){var n=e||"",r="";if(arguments.length>2)for(var i=0,s=arguments.length-1;i<s;i++)r+=(i?"/":"")+encodeURIComponent(arguments[i]);else{var o=t&&t.hash||t;o&&o["expand-tokens"]?r=l.Util.expandToken(n,this,!0):r=n}if(Backbone.history._hasPushState){var u=Backbone.history.options.root;return u==="/"&&r.substr(0,1)==="/"?r:u+r}return"#"+r}),Handlebars.registerViewHelper("view",{factory:function(e,t){var n=e.length>=1?e[0]:l.View;return l.Util.getViewInstance(n,t.options)},modifyHTMLAttributes:function(e,t){e.tagName=(t.el.tagName||t.el.name||"").toLowerCase()},callback:function(e){var t=arguments[arguments.length-1],n=t._helperOptions.options,r=t.cid;if(!_.isString(e)&&n.hash&&_.keys(n.hash).length>0)throw new Error(p("view-helper-hash-args"));n.fn&&(V[r]=n.fn)}}),w.model.defaultOptions.populate=!0;var Mt=w.model.change;w.model.change=function(e,t,n){e._isChanging=!0,Mt.apply(e,arguments),e._isChanging=!1;if(n&&n.serializing)return;var r=jt(e);e._renderCount&&r&&e.populate(!r.context&&e.model.attributes,r)},_.extend(l.View.prototype,{serialize:function(){var e,t,n;for(var r=0;r<arguments.length;++r)_.isFunction(arguments[r])?e=arguments[r]:_.isObject(arguments[r])&&("stopPropagation"in arguments[r]&&"preventDefault"in arguments[r]?n=arguments[r]:t=arguments[r]);if(n&&!this._preventDuplicateSubmission(n))return;t=_.extend({set:!0,validate:!0,children:!0},t||{});var i=t.attributes||{},s=this,o=[];Pt(this,t,function(e,t,n,r){var o=s._getInputValue(e,r);_.isUndefined(o)||Ht(i,n,{mode:"serialize"},function(e,t){e[t]?_.isArray(e[t])?e[t].push(o):e[t]=[e[t],o]:e[t]=o})}),t._silent||this.trigger("serialize",i,t);if(t.validate){var u=this.validateInput(i);u&&u.length&&(o=o.concat(u)),this.trigger("validate",i,o,t);if(o.length){this.trigger("invalid",o);return}}if(t.set&&this.model&&!this.model.set(i,{silent:t.silent,serializing:!0}))return!1;var a=this;return e&&e.call(this,i,function(){Bt(a)}),i},_preventDuplicateSubmission:function(e,t){e.preventDefault();var n=$(e.target);return(e.target.tagName||"").toLowerCase()!=="form"&&(n=$(e.target).closest("form")),n.attr("data-submit-wait")?!1:(n.attr("data-submit-wait","true"),t&&t.call(this,e),!0)},populate:function(e,t){t=_.extend({children:!0},t||{});var n,e=e||this._getContext();Pt(this,t,function(t,r,i,s){Ht(e,i,{mode:"populate"},function(e,r){n=e&&e[r];if(!_.isUndefined(n)){var i=s==="checkbox"||s==="radio";i?(n=_.isBoolean(n)?n:n===t.val(),t[n?"attr":"removeAttr"]("checked","checked")):t.val(n)}})}),++this._populateCount,t._silent||this.trigger("populate",e)},validateInput:function(){},_getInputValue:function(e,t){if(t!=="checkbox"&&t!=="radio")return e.val()||"";var n=e[e.prop?"prop":"attr"]("checked");if(n||n===""){var r=e.attr("value");return r==="on"||r||!0}},_populateCount:0}),l.View.on({"before:rendered":function(){if(!this._renderCount||(this.model&&this.model.cid)!==this._formModelCid)return;var e=this.getObjectOptions(this.model);this.previousFormData=_t(this.serialize(_.extend({set:!1,validate:!1,_silent:!0},e)),function(e){return e!==""&&e!=null})},rendered:function(){var e=jt(this);e&&!this._isChanging&&!this._populateCount&&this.populate(!e.context&&this.model.attributes,e),this.previousFormData&&this.populate(this.previousFormData,_.extend({_silent:!0},e)),this._formModelCid=this.model&&this.model.cid,this.previousFormData=null}}),$serverSide||l.View.on({invalid:Dt,error:Dt,deactivated:function(){this.$el&&Bt(this)}});var Ft="data-call-method",It="data-trigger-event";Handlebars.registerHelper("button",function(e,t){arguments.length===1&&(t=e,e=t.hash.method);var n=t.hash,r=n["expand-tokens"];delete n["expand-tokens"];if(!e&&!t.hash.trigger)throw new Error(p("button-trigger"));return k(n),n.tagName=n.tagName||"button",n.trigger&&(n[It]=n.trigger),delete n.trigger,e&&(n[Ft]=e),new Handlebars.SafeString(l.Util.tag(n,t.fn?t.fn(this):"",r?this:null))}),Handlebars.registerHelper("link",function(){var e=_.toArray(arguments),t=e.pop(),n=t.hash,r=e.length===0?[n.href]:e,i=n["expand-tokens"];delete n["expand-tokens"];if(!r[0]&&r[0]!=="")throw new Error(p("link-href"));return k(n),r.push(t),n.href=Handlebars.helpers.url.apply(this,r),n.tagName=n.tagName||"a",n.trigger&&(n[It]=t.hash.trigger),delete n.trigger,n[Ft]="_anchorClick",new Handlebars.SafeString(l.Util.tag(n,t.fn?t.fn(this):"",i?this:null))});var qt="["+Ft+"], ["+It+"]",Ut;$(document).ready(function(){l._fastClickEventName||zt()});var Xt="data-element-tmp";Handlebars.registerHelper("element",function(e,t){k(t.hash);var n=_.uniqueId("element"),r=t.data.view;return t.hash[Xt]=n,r._elementsByCid||(r._elementsByCid={}),r._elementsByCid[n]=e,r._pendingElement||(r._pendingElement=!0,r.once("append",Vt)),new Handlebars.SafeString(l.Util.tag(t.hash))}),Handlebars.registerHelper("super",function(e){var t=e.data.view,n=t.constructor&&t.constructor.__super__;if(n){var r=n.template;if(!r){if(!n.name)throw new Error(p("super-parent"));r=n.name}return _.isString(r)&&(r=l.Util.getTemplate(r,!1)),new Handlebars.SafeString(r(this,e))}return""});var $t="load:start",Jt="load:end",Kt;l.setRootObject=function(e){Kt=e},l.loadHandler=function(e,t,n){var r=_.uniqueId("load");return function(i,s,o){function f(){if(a.timeout&&!a.run)return;var t=u._loadingTimeoutDuration!==undefined?u._loadingTimeoutDuration:l.View.prototype._loadingTimeoutDuration;a.timeout=setTimeout(l.bindSection("load-start",function(){a.events.length&&(a.run=!0,e.call(u,a.message,a.background,a))}),t*1e3)}if($serverSide)return;var u=n||this;u._loadInfo=u._loadInfo||{};var a=u._loadInfo[r];a?(clearTimeout(a.endTimeout),a.message=i,!s&&a.background&&(a.background=!1,f())):(a=u._loadInfo[r]=_.extend({isLoading:function(){return a.events.length},cid:r,events:[],timeout:0,message:i,background:!!s},Backbone.Events),f());if(_.indexOf(a.events,o)>=0)return;a.events.push(o);var c=function(){var e=u._loadingTimeoutEndDuration;e===void 0&&(e=l.View.prototype._loadingTimeoutEndDuration);var n=a.events,i=_.indexOf(n,o);i>=0&&!o.isLoading()&&(n.splice(i,1),_.indexOf(n,o)<0&&o.off(Jt,c)),n.length||(clearTimeout(a.endTimeout),a.endTimeout=setTimeout(l.bindSection("load-end",function(){n.length||(a.run&&(t&&t.call(u,a.background,a),a.trigger(Jt,a)),clearTimeout(a.timeout),a=u._loadInfo[r]=undefined)}),e*1e3))};o.on(Jt,c)}},l.forwardLoadEvents=function(e,t,n){function r(i,s,o){n&&e.off($t,r),t.trigger($t,i,s,o)}return e.on($t,r),{off:function(){e.off($t,r)}}},l.mixinLoadable=function(e,t){_.extend(e,{_loadingClassName:"loading",_loadingTimeoutDuration:.33,_loadingTimeoutEndDuration:.1,onLoadStart:function(e,n,r){var i=t?this.parent:this;if(!i||!i.el)return;!i.nonBlockingLoad&&!n&&Kt&&Kt!==this&&Kt.trigger($t,e,n,r),i._isLoading=!0,i.$el.addClass(i._loadingClassName),i.trigger("change:load-state","start",n)},onLoadEnd:function(){var e=t?this.parent:this;if(!e||!e.el)return;e._isLoading=!1,e.$el.removeClass(e._loadingClassName),e.trigger("change:load-state","end")}})},l.mixinLoadableEvents=function(e,t){_.extend(e,{_loadCount:0,isLoading:function(){return this._loadCount>0},loadStart:function(e,n){this._loadCount++;var r=t?this.parent:this;r.trigger($t,e,n,r)},loadEnd:function(){this._loadCount--;var e=t?this.parent:this;e.trigger(Jt,e)}})},l.mixinLoadable(l.View.prototype),l.mixinLoadableEvents(l.View.prototype),l.HelperView&&(l.mixinLoadable(l.HelperView.prototype,!0),l.mixinLoadableEvents(l.HelperView.prototype,!0)),l.CollectionHelperView&&(l.mixinLoadable(l.CollectionHelperView.prototype,!0),l.mixinLoadableEvents(l.CollectionHelperView.prototype,!0)),l.sync=function(e,t,n){var r=this,i=n.complete;return n.complete=function(){r._request=undefined,r._aborted=!1,i&&i.apply(this,arguments)},this._request=Backbone.sync.apply(this,arguments),this._request};var Qt,Gt=Backbone.History.prototype.loadUrl;Backbone.History.prototype.loadUrl=function(){return Backbone.history.once("route",function(){Qt=Backbone.history.getFragment()}),Qt=!1,Gt.apply(this,arguments)};var nn=[];l.Model&&nn.push(l.Model),l.Collection&&nn.push(l.Collection),_.each(nn,function(e){var t=e.prototype.fetch;l.mixinLoadableEvents(e.prototype,!1),_.extend(e.prototype,{sync:l.sync,fetch:function(n){n=n||{},e===l.Collection&&(_.find(["reset","remove","add","update"],function(e){return!_.isUndefined(n[e])})||(n.reset=!0));if(!n.loadTriggered){var r=this;function i(e){var t=n[e];n[e]=function(){r.loadEnd(),t&&t.apply(this,arguments)}}i("success"),i("error"),r.loadStart(undefined,n.background)}return en(this,n||{},t)},load:function(e,t,n){arguments.length===2&&!_.isFunction(t)&&(n=t,t=!1),n=n||{},!n.background&&!this.isPopulated()&&Kt&&(this.isLoading()?Kt.trigger($t,n.message,n.background,this):l.forwardLoadEvents(this,Kt,!0)),Zt(this,e,t,n)}})}),l.Util.bindToRoute=Yt,l.View.prototype._modifyDataObjectOptions=function(e,t){return t.ignoreErrors=this.ignoreFetchError,t.background=this.nonBlockingLoad,t},l.HelperView.prototype._modifyDataObjectOptions=l.CollectionHelperView.prototype._modifyDataObjectOptions=function(e,t){return t.ignoreErrors=this.parent.ignoreFetchError,t.background=this.parent.nonBlockingLoad,t},w.collection.loading=function(e){var t=e.loadingView,n=e.loadingTemplate,r=e.loadingPlacement;if(t||n){var i=l.loadHandler(function(){var i;e.collection.length===0&&e.$el.empty();if(t){var s=l.Util.getViewInstance(t);e._addChild(s),n?s.render(n):s.render(),i=s}else i=e.renderTemplate(n);var o=r?r.call(e):e.collection.length;e.appendItem(i,o),e.$el.children().eq(o).attr("data-loading-element",e.collection.cid)},function(){e.$el.find('[data-loading-element="'+e.collection.cid+'"]').remove()},e.collection);e.listenTo(e.collection,"load:start",i)}},l.CollectionHelperView&&_.extend(l.CollectionHelperView.attributeWhiteList,{"loading-template":"loadingTemplate","loading-view":"loadingView","loading-placement":"loadingPlacement"}),l.View.on({"load:start":l.loadHandler(function(e,t,n){this.onLoadStart(e,t,n)},function(e,t){this.onLoadEnd(t)}),collection:{"load:start":function(e,t,n){this.trigger($t,e,t,n)}},model:{"load:start":function(e,t,n){this.trigger($t,e,t,n)}}}),Handlebars.registerHelper("loading",function(e){var t=e.data.view;return t.off("change:load-state",rn,t),t.on("change:load-state",rn,t),t._isLoading?e.fn(this):e.inverse(this)});var sn=navigator.userAgent.match(/(iPhone|iPod|iPad)/i),on=navigator.userAgent.toLowerCase().indexOf("android")>-1?1:0,un=on?1:0;l.Util.scrollTo=function(e,t){function n(){window.scrollTo(e,t)}return t=t||un,sn?_.defer(n):n(),[e,t]},l.LayoutView.on("change:view:end",function(e,t,n){n&&n.scroll&&l.Util.scrollTo(0,0)}),l.Util.scrollToTop=function(){return this.scrollTo(0,0)},l.View.on({"submit form":function(){var e=$(":focus")[0];e&&e.blur()}}),$.fn.tapHoldAndEnd=function(e,t,n){return this.each(function(){function o(){clearTimeout(i),r&&s&&n(s),s=undefined,r=!1}var r,i,s;$(this).on("touchstart",e,function(e){if($(e.currentTarget).attr("data-no-tap-highlight"))return;o(),s=e.currentTarget,i=setTimeout(function(){r=!0,t(s)},50)}).on("touchmove touchend",o),$(document).on("touchcancel",o)})};var an=!on;l.configureTapHighlight=function(e,t){an=e,t=t||"tap-highlight";if(!e){function n(e){var n=e&&e.tagName.toLowerCase();if(n==="input"||n==="select"||n==="textarea")e=$(e).closest("[data-tappable=true]")[0]||e;if(e)return $(e).addClass(t),!1}function r(){$("."+t).removeClass(t)}$(document.body).tapHoldAndEnd("[data-tappable=true], a, input, button, select, textarea",n,r)}};var fn={A:!0,INPUT:!0,BUTTON:!0,SELECT:!0,TEXTAREA:!0};l.View.on({rendered:cn,"rendered:collection":cn,"rendered:item":cn,"rendered:empty":cn});var hn=l.View.prototype._addEvent;l.View.prototype._addEvent=function(e){return this._domEvents=this._domEvents||[],e.type==="DOM"&&this._domEvents.push(e.originalName),hn.call(this,e)}})()