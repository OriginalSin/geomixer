# ComponentsManager

Служит для управления порядком инициализации отдельных компонентов приложения.

## API

В глобальную область видимости экспортируется переменная `cm` - экземпляр класса `ComponentsManager`, который имеет следующие методы:

- `define(<String>id, <Array[String]>dependencies, <Function>constructor)` - добавить в очередь инициализации компоент с идентификатором `id`, который зависит от компонентов с `id`, перечисленными в `dependencies`. Когда все компоненты из `dependencies` будут созданы, вызовется функция `constructor`.
- `<Mixed>get(<String>id)` - получить instance компонента `id`
- `<Promise>create()` - запустить инициализацияю компонентов

### Конструктор компонента

Компонент инициализируется функцией (конструктором), которая принимает два параметра:

- `cm` - instance менеджера компонентов
- `cb` - коллбэк для асинхронного создания компонентов

Если конструктор не возвращает значения, то инициализация компонента считается асинхронной и менеджер компонентов будет ждать вызова `cb`. В любом другом случае экземпляром компонента считается то, что вернул конструктор.

**Если инициализация компонентов не выполняется или зависает, то в первую очередь нужно проверить, что все конструкторы либо возвращают не `undefined`, либо гарантируют вызов `cb`**.

### Примечания

- Компонент не обязательно должен напрямую зависеть от всех компонентов, указанных в `dependencies`. Тот факт, что он указан в `dependencies` лишь гарантирует то, что к моменту вызова конструктора он будет инициализирован.
- Это же утверждение работает и в обратном направлении. Для вызова `mp.get()` не обязательно указывать компонент в `dependencies`. Если он не будет создан к моменту вызова функции, то она просто вернёт `null`, однако при этом важно, чтобы вызываемый компонент был объявлен функцией `define`. Эту особенность можно использовать, например, в обработчиках событий.
- Все необходимые компоненты должны быть объявлены перед вызовом `create()`.

## Пример использования

```javascript
cm.define('Map', [], function() {
    return L.map('map').setView([53.776022, 82.968750], 3);
});

cm.define('BaseLayersManager', ['Map'], function(cm, cb) {
    var map = cm.get('Map');
    map.gmxBaseLayersManager.initDefaults().then(function() {
        map.gmxBaseLayersManager.setActiveIDs(['OSM', 'grey', 'outline']).setCurrentID('OSM');
        cb(map.gmxBaseLayersManager);
    });
});

cm.create();
```